
How the HP-GPS configuration database works


Database structure:

The structure is sort of odd, but flexible.  I didn't want
to have to clean the database every time it was necessary
to add a new parameter, so I set it up as kind of a total,
where the ID field contains the parameter name, with
fields for the applicable equipment ID, the parameter's
value, and the date of last change.

The odd feature is that there are three record types:
float, integer and string.  The record type used depends on
the parameter's data type.


File/parameter dependencies:

The key to the system is that you can specify that file X
must get regenerated when parameter Y changes.  The form
dependencies.frm sets up the dependencies, as in this
example with hpgps_auto_config.frm:

.init \
  addfile("hpgps_auto_config.frm", "hack"),
  addparam("hpgps_auto_config.frm", "center x"),
  addparam("hpgps_auto_config.frm", "center y"),
  addparam("hpgps_auto_config.frm", "bucket x"),
  addparam("hpgps_auto_config.frm", "bucket y"),
  ...

When the user chooses to update the files, the code compares
the last-change dates of a file with the dates of its
associated parameters (the filenames are also stored in the
database along with their last-change dates).

The exact association between a parameter and its dependent
file(s) is found in createfiles.frm, where each file has
an associated expression that creates the file from its
parameters.


Adding a parameter:

-dependencies.frm:  If the dependent file is already
defined (with an "addfile"), just add an "addparam" line
with the filename and the name of the parameter (you can
call the parameter anything you want).  Do the same
for other files that may be dependent on the parameter.

-defaults.frm:  If the parameter has a default value,
add a "set_default" line for it.

-createfiles.frm:  You'll have to modify the expressions
that correspond to all the parameter's dependent files.
The expression names are created by taking the filename
and converting periods into underscores; for example,
hp.GPS.cfg has an expression named "hp_GPS_cfg".
The modification consists of adding another WRITE statement,
and sometimes some code to group the parameter values
by equipment ID.

-Entry form: Parameter values are changed through several
forms:  excav_info.frm, geodata.frm, polygons.frm, and
elevations.frm.  Decide which form to add the parameter
to (or make a new one), and use an existing parameter
as an example of how to set it up.
