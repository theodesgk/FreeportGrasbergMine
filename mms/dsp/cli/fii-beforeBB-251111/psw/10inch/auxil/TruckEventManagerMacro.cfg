#!/psw/cpp

#ifdef TRUCKEVENTMANAGER 
#	if (DEMAJOR == 6 && DEMINOR == 6 && DEMAINT >= 8) || (DEMAJOR > 6 || DEMINOR >= 7)
		/* 
		 * Default settings for TruckEventMananger, can be overridden in psw/10inch/Central.cfg
		 * with symbol definitions 
		 *
		 */ 
		message	targetupdateconf shovel
#		ifndef	MOBILEAPI
			macro SetUpdateConf	TruckEventManager targetupdateconf:truck
#		else
			macro SetUpdateConf 	ne? "$(targetupdateconf)" "$(nil)" TruckEventManager targetupdateconf:"$(targetupdateconf)";
#		endif
		message allowablebucketrangeconf 0.25

		symbol	targetUsed	0
		symbol	truckLoaded	""
#		if (DEMAJOR > 6 || DEMINOR >= 7)
			macro StoreTargetInfo	targetUsed $(TruckEventManager targetpayloadmetric);\
						truckLoaded $(TruckEventManager truckloading);
#		else
			macro StoreTargetInfo	""
#		endif

		macro	InitDspIntegManager	TruckEventManager allowablebucketrangeconf:"$(allowablebucketrangeconf)";\
						SetUpdateConf;
		symbol	doOverloadFlash	0
		macro	StopOverloadFlash	doOverloadFlash 0; w0.InfAct colors:default;
		macro	SendTargetUp		ne? targetUsed 0 EQ-REQ "excavatortarget" [ "$(truckLoaded)" "$(targetUsed)" ];
		macro	EndLoading		StopOverloadFlash; SendTargetUp; truckLoaded ""; targetUsed 0;
		macro	DoNormalLoadColor	w0.InfAct colors:default; eq? $(doOverloadFlash) 1 WinMgr after:1:DoOverloadIndicator;
		macro	UpdateWarnLoadDisplay	w0.InfAct colors:yellowLabel; UpdateLoadDisplay; postBucketTrans;
		macro	UpdateWarn2LoadDisplay	w0.InfAct clear; w0.InfAct colors:yellowLabel; postBucketTrans;\
						w0.InfAct write:"$(TruckEventManager emptyspace) $(msg.tonunit) $(OverTargetLbl)";
		macro	DoOverloadIndicator	eq? $(doOverloadFlash) 1 w0.InfAct colors:Down; WinMgr after:1:DoNormalLoadColor;
		symbol	isInitialBucket	0
		macro	SetIsInitialBucket	isInitialBucket 1; ClearTrans;
		macro	postBucketTrans		eq? "$(TruckEventManager targetupdateconf)" "shovel"\
						postTrans "$(TruckEventManager truckloading) $(HasMsg) $(TruckEventManager currenttruckpayload) $(BucketTransactionMsg)";
		macro	UpdateLoadDisplay	UpdateCurAct; UpdateInfAct;\
						eq? $(isInitialBucket) 0 postBucketTrans;\
						StoreTargetInfo;\
						isInitialBucket 0;
		macro	UpdateCurAct		w0.CurAct clear;\
						w0.CurAct write:"$(LoadingLbl) $(TruckEventManager truckloading) ($(TruckEventManager targetpayload) $(msg.tonunit))";
		macro	UpdateInfAct		w0.InfAct clear;\
						w0.InfAct write:"$(TruckEventManager emptyspace) $(msg.tonunit) / $(TruckEventManager bucketsuntilfull) $(RemainingLbl)";
		macro	UpdateOverloadDisplay	w0.InfAct clear; postBucketTrans;\
						ne? $(doOverloadFlash) 1 DoOverloadIndicator; doOverloadFlash 1;\
						w0.InfAct write:"$(TruckEventManager emptyspace) $(msg.tonunit) $(OverTargetLbl)";
		macro	UpdateNoTargetDisplay	w0.CurAct clear;\
						w0.InfAct clear;\
						w0.CurAct write:"$(LoadingLbl) $(TruckEventManager truckloading)";
		macro	HandleNextAct	ne? $1 $(state) IconInit; \
					ne? $1 8 w0.CurAct label:$2; \
					tbt_goto $2; \
					w0.NextAct label:$3;\
					StopOverloadFlash;
#	else
		macro InitTruckEventManager	""
#	endif
#else
		macro InitTruckEventManager	""
#endif
