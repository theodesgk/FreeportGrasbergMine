#!/psw/cpp
/*
 * * * * * * * * * * * * * * * * * * *
 *  DISPATCH Real-Time Firmware Module
 * Copyright (c) Modular Mining Systems, 1982-2011
 *               All Rights Reserved
 *  $RCSfile: QuickMessage.cfg,v $
 * $Revision: 1.2 $
 *   $Author: dcitron $
 *     $Date: 2015/11/11 07:08:42 $
 *    $State: Exp $
 * * * * * * * * * * * * * * * * * * *
 */
in	QM_Update	INT_RPC	ds	QMUpdate$(quickmesg_support)
macro	QMUpdateQMY	QuickMessage messageSafe:$1|$2;SetUpdateTime
in	QM_Delete	INT_RPC	d	QMDelete$(quickmesg_support)
macro	QMDeleteQMY	QuickMessage deleteSafe:$1

macro	SetUpdateTime	QuickMessage messageSafe:"10000|$(Time day)-$(Time month)-$(Time year) $(Time hour):$(Time minute):$(Time second)"
symbol	lastUpdate
macro	SendQMUpdateQMY	QuickMessage id:10000;lastUpdate $(QuickMessage message);\
        eq? "$(lastUpdate)" " " EQ-REQ "quick_mess" [ "unknown" "$(QuickMessage messageList)" ];\
        ne? "$(lastUpdate)" " " EQ-REQ "quick_mess" [ "$(QuickMessage message)" "$(QuickMessage messageList)" ]

symbol  qmopen  n
macro   doQuickMessage  SpeedCheck "$(SpeedMsg)" "showQuickMessage" "doPreventChat"
macro   showQuickMessage        qmopen y;QuickMessage show
macro   sendQuickMessage        MESSAGE "$(QuickMessage selected)";qmopen n

/* non functioning macros if Quick Message not supported */
symbol	QMrecv	n
macro	SendQMUpdateQMN	QMrecv s
macro	QMUpdateQMN	QMrecv y
macro	QMDeleteQMN	QMrecv y

/* for testing */
macro	doQMShow	foreach $(QuickMessage messageList);do showQM
macro	showQM		QuickMessage id:$2;postTrans "$1:$2:$(QuickMessage message)"
macro	QMShowBtn	KMENU2 Options [ 'Show\ Quick\nMessages doQMShow' ]
