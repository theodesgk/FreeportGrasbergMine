%!/psw/cpp
symbol	iconName
symbol	actionName
symbol	incrementFrom	

/*
 * EXPLANATION OF HOW THIS STUFF WORKS STARTS HERE!!!
 *
 * 1. Menus are now stored as strings in symbol objects
 * 2. The symbol objects are created as they are required - you
 *    won't find them listed within this code
 * 3. When a menu is required a generic window with a pre-set
 *    number of buttons is posted and the button labels, icons
 *    and actions are populated from the appropriate symbols
 * 4. The actual button-specific information may be stored across
 *    multiple symbols for a single menu. This is because Forms is
 *    limited to 128 characters
 */
	
symbol	genValue
symbol	genericAction
symbol	lastAction
symbol	nextAction
symbol	menuType

symbol	reqMenu Trucks
symbol	foundMenu

symbol	menusLoaded

symbol	menuComponentsLoaded	0

macro	CreateSubmenuObjects	Macro symbol menuText.$2;\
				Macro symbol menuAction.$2;\
				Macro symbol menuIcon.$2;\
				Macro symbol menuLast.$2;\
				Macro symbol menuNext.$2;\
				Macro symbol menuIncrement.$2

in	NEW-MENU-OBJ	0xc5	sb[b]	Macro symbol menuNum.$2;\
					Macro symbol menuName.$2;\
					menuName.$2 $1;\
					foreach $3;do CreateSubmenuObjects;\
					menuNum.$2 '$3'


in	NEW-MENU-STR	0xc6	bbb[s]	menuIncrement.$1 $2;\
                                        eq? $3 0 menuType "menuText";\
					eq? $3 1 menuType "menuAction";\
                                        $(menuType).$1 '$4'

					

in	NEW-MENU-INT	0xc7	bbb[b]	menuIncrement.$1 $2;\
					eq? $3 0 menuLast.$1 '$4';\
					eq? $3 1 menuNext.$1 '$4';\
                                        eq? $3 2 menuIcon.$1 '$4';\
					eq? $3 3 menusLoaded '$4'

/* List of menus that are currently loaded
 * Sub-menus (eg Trucks2, Trucks3, etc) are
 * not named specifically 
 */
 /*
symbol	menuName.0 Trucks
symbol	menuName.1 Material
symbol	menuName.2 Shovels
*/

/* Links to know which menu components need to be loaded
 * based on the menu requested. This is necessary because
 * string length restrictions may force a menu to be split
 * into components for transmission and storage
 */
symbol	menuNum.-1
/*
symbol	menuNum.0 '8 1'
symbol	menuNum.1 '2'
symbol	menuNum.2

symbol	menuNum.3
symbol	menuNum.4
symbol	menuNum.5
symbol	menuNum.6
symbol	menuNum.7
symbol	menuNum.8
symbol	menuNum.9
*/

/* The actual text displayed to the operator. The first parameter
 * is the starting point to use, in case of split menus
symbol	menuText.8 '0 ["DT34" "DT35" "DT36" "DT37" "DT38" "DT39" "DT40"]'
symbol	menuText.1 '7 ["DT41" "DT42" "DT43" "DT44" "DT45"]'
symbol	menuText.2 '0 ["DT46" "DT47" "DT48" "DT49" "DT50" "DT51" "0" "0" "0" "0" "0" "0"]'
symbol	menuText.3
symbol	menuText.4
symbol	menuText.5
symbol	menuText.6
symbol	menuText.7
symbol	menuText.0
symbol	menuText.9
*/

/* The action to perform or value to store when each button is pressed
symbol	menuAction.8 '["DT34" "DT35" "DT36" "DT37" "DT38" "DT39" "DT40"]'
symbol	menuAction.1 '["DT41" "DT42" "DT43" "DT44" "DT45"]'
symbol	menuAction.2 '["DT46" "DT47" "DT48" "DT49" "DT50" "DT51" "0" "0" "0" "0" "0" "0"]'
symbol	menuAction.3
symbol	menuAction.4
symbol	menuAction.5
symbol	menuAction.6
symbol	menuAction.7
symbol	menuAction.0
symbol	menuAction.9
 */

/* The icon to display, if applicable. The first parameter contains the
 * menus to load when the next/last buttons are pressed. -1 indicates
 * no scroll action
symbol	menuIcon.8 '[1 1 1 1 1 1 1]'
symbol	menuIcon.1 '[1 1 1 1 1]'
symbol	menuIcon.2 '[1 1 1 1 1 1 0 0 0 0 0 0]'
symbol	menuIcon.3
symbol	menuIcon.4
symbol	menuIcon.5
symbol	menuIcon.6
symbol	menuIcon.7
symbol	menuIcon.0
symbol	menuIcon.9
 */

/*
symbol	menuIncrement.8 0
symbol	menuIncrement .1 7

symbol	menuLast.8 '-1'
symbol	menuLast.1 '-1 '
symbol	menuLast.2 '8 1'
symbol	menuNext.8 '2 '
symbol	menuNext.1 '2 '
symbol	menuNext.2 '-1'
*/


symbol	menuVal

macro	CheckLoadedMenus	foreach $(menusLoaded);do eq? \$(menuName.\$1) \$(reqMenu) SetMenuToLoad

macro	SetMenuToLoad		menuVal $(menuNum.$1);LoadMenu
macro	LoadMenu		foreach $(menuVal);do MENU-DATA 12 \$(menuText.\$2) \$(menuAction.\$2) \$(menuIcon.\$2);\
				foreach $(menuVal);do ne? "\$(menuLast.\$2)" "-1" wGeneric12.b4 action:"menuVal \$(menuLast.\$2);LoadMenu;WinMgr window:wGeneric12";\
				foreach $(menuVal);do ne? "\$(menuNext.\$2)" "-1" wGeneric12.b5 action:"menuVal \$(menuNext.\$2);LoadMenu"

/*
 * Receive menus from central or load from memory
 *
 * $1 generic menu window (12 or 20 buttons)
 * $2 increment point (if previous menus were too long to send in one hit)
 * $3 button labels (0 indicates no data - objects should be unmapped)
 * $4 action parameters (indicates what to send back to central)
 * $5 icon values
 */

symbol	cfgIcon.1 gps
symbol	cfgIcon.2 left

in	MENU-DATA	0xc2	bb[s][s][b]	incrementFrom $2;\
						foreach $4;do wGeneric$1.bkgnd\$(+ \$(incrementFrom) \$1) label:"\$2" map:y;\
						foreach $3;do wGeneric$1.lbl\$(+ \$(incrementFrom) \$1) label:"\$2" map:y;\
						foreach $5;do wGeneric$1.icon\$(+ \$(incrementFrom) \$1) icon:\$(cfgIcon.\$2) map:y;\
						foreach $3;do eq? "\$2" "0" wGeneric$1.lbl\$(+ \$(incrementFrom) \$1) map:n;\
						foreach $3;do eq? "\$2" "0" wGeneric$1.icon\$(+ \$(incrementFrom) \$1) map:n;\
						foreach $3;do eq? "\$2" "0" wGeneric$1.bkgnd\$(+ \$(incrementFrom) \$1) map:n;\
						WinMgr window:wGeneric$1

out     MENU-REQ        0xc3    bbb     sendto up
