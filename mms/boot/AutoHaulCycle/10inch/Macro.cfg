%! /psw/cpp
/*
 * * * * * * * * * * * * * * * * * * *
 *  DISPATCH Real-Time Firmware Module
 * Copyright (c) Modular Mining Systems, 1982-2009
 *               All Rights Reserved
 *  $RCSfile: Macro.cfg,v $
 * $Revision: 1.15 $
 *   $Author: dcitron $
 *     $Date: 2017/08/17 16:26:15 $
 *    $State: Exp $
 *   Purpose: Macro configuration file for Haul-Cycle Automation
 * * * * * * * * * * * * * * * * * * *
 */

#if #arch(pe)

#if !#option(StoreForward)
#   include <StoreForward/10inch/Macro.cfg>
#endif

#pre-definitions in case not defined in HCA_config.cfg
symbol HCA_CHECK_DEST	no
symbol HCA_CHECK_DEST_WARN no
symbol HCA_GPS_FULL_LOGIC	off
symbol HCA_SKIP_DIRTRAV	no
symbol HCA_DIPPER_TIMEOUT	60
symbol HCA_DIPPER_MIN		50
# not sure unitrig dumping evt will work so have capability to disable
symbol USE_UNITRIG_DUMP_EVT	no

# include <AutoHaulCycle/HCA_config.cfg>

symbol 10inch_HCA	1
# HCA Cases
symbol INVALID_CASE       0
symbol hcaCaseDebug.0	"INVALID_CASE"
symbol CONN_BKT_INTERFACE 1
symbol hcaCaseDebug.1	"CONN_BKT_INTERFACE"
symbol CONN_BKT           2
symbol hcaCaseDebug.2	"CONN_BKT"
symbol CONN_FULL_VIMS     3
symbol hcaCaseDebug.3	"CONN_FULL_VIMS"
symbol CONN_FULL_PLM      4
symbol hcaCaseDebug.4	"CONN_FULL_PLM"
symbol CONN_FULL          5
symbol hcaCaseDebug.5	"CONN_FULL"
symbol CONN_ARR_DUMP_VIMS 6
symbol hcaCaseDebug.6	"CONN_ARR_DUMP_VIMS"
symbol CONN_ARR_DUMP_PLM  7
symbol hcaCaseDebug.7	"CONN_ARR_DUMP_PLM"
symbol CONN_ARR_DUMP_DIN  8
symbol hcaCaseDebug.8	"CONN_ARR_DUMP_DIN"
symbol CONN_ARR_DUMP      9
symbol hcaCaseDebug.9	"CONN_ARR_DUMP"
symbol CONN_ASSIGN_VIMS   10
symbol hcaCaseDebug.10	"CONN_ASSIGN_VIMS"
symbol CONN_ASSIGN_PLM    11
symbol hcaCaseDebug.11	"CONN_ASSIGN_PLM"
symbol CONN_ASSIGN_DIN    12
symbol hcaCaseDebug.12	"CONN_ASSIGN_DIN"
symbol CONN_ASSIGN        13
symbol hcaCaseDebug.13	"CONN_ASSIGN"
symbol CONN_ARR_SHOV      14
symbol hcaCaseDebug.14	"CONN_ARR_SHOV"
symbol BKT_INTERFACE      15
symbol hcaCaseDebug.15	"BKT_INTERFACE"
symbol HCA_BKT            16
symbol hcaCaseDebug.16	"HCA_BKT"
symbol FULL_VIMS          17
symbol hcaCaseDebug.17	"FULL_VIMS"
symbol FULL_PLM           18
symbol hcaCaseDebug.18	"FULL_PLM"
symbol HCA_FULL           19
symbol hcaCaseDebug.19	"HCA_FULL"
symbol ARR_DUMP_VIMS      20
symbol hcaCaseDebug.20	"ARR_DUMP_VIMS"
symbol ARR_DUMP_PLM       21
symbol hcaCaseDebug.21	"ARR_DUMP_PLM"
symbol ARR_DUMP_DIN       22
symbol hcaCaseDebug.22	"ARR_DUMP_DIN"
symbol ARR_DUMP           23
symbol hcaCaseDebug.23	"ARR_DUMP"
symbol ASSIGN_VIMS        24
symbol hcaCaseDebug.24	"ASSIGN_VIMS"
symbol ASSIGN_PLM         25
symbol hcaCaseDebug.25	"ASSIGN_PLM"
symbol ASSIGN_DIN         26
symbol hcaCaseDebug.26	"ASSIGN_DIN"
symbol HCA_ASSIGN         27
symbol hcaCaseDebug.27	"HCA_ASSIGN"
symbol ARR_SHOV           28
symbol hcaCaseDebug.28	"ARR_SHOV"
symbol CONN_FULL_GPS	  29
symbol hcaCaseDebug.29	"CONN_FULL_GPS"
symbol FULL_GPS		  30
symbol hcaCaseDebug.30	"FULL_GPS"

#######################################
# Constants
#######################################
symbol DIGITAL_INPUT_OFF   0
symbol DIGITAL_INPUT_ON    1
symbol UNIT_NONE           0
symbol UNIT_SHOVEL         2
symbol UNIT_DUMP           3
symbol UNIT_CRUSHER        4
symbol UNIT_STOCKPILE      5
symbol UNIT_BLAST          6
symbol STATUS_NONE         0
symbol STATUS_READY        2

# Driver IDs
symbol VIMS_GEN_DRIVER_ID      5.1
symbol VIMS_797B_DRIVER_ID     5.2
symbol VIMS_785B_DRIVER_ID     5.3
symbol VIMS_785C_DRIVER_ID     5.4
symbol VIMS_789B_DRIVER_ID     5.5
symbol VIMS_789B0700_DRIVER_ID 5.6
symbol VIMS_793B_DRIVER_ID     5.7
symbol VIMS_793C_DRIVER_ID     5.8
symbol VIMS_793C0700_DRIVER_ID 5.9
symbol VIMS_994D_DRIVER_ID     5.10
symbol VIMS_793D_DRIVER_ID     5.11
symbol VIMS_797A_DRIVER_ID     5.12
symbol VIMS_994F_DRIVER_ID     5.14
symbol VIMS_797F_DRIVER_ID     5.15
symbol PLM_GEN_DRIVER_ID       2.1
symbol UNITRIG_GEN_DRIVER_ID   71.1

# Parameter IDs
symbol VIMS_GEN_PAYLD_PAR_MCID       5.1.523
symbol VIMS_797B_PAYLD_PAR_MCID      5.2.523
symbol VIMS_785B_PAYLD_PAR_MCID      5.3.523
symbol VIMS_785C_PAYLD_PAR_MCID      5.4.523
symbol VIMS_789B_PAYLD_PAR_MCID      5.5.523
symbol VIMS_789B0700_PAYLD_PAR_MCID  5.6.523
symbol VIMS_793B_PAYLD_PAR_MCID      5.7.523
symbol VIMS_793C_PAYLD_PAR_MCID      5.8.523
symbol VIMS_793C0700_PAYLD_PAR_MCID  5.9.523
symbol VIMS_994D_PAYLD_PAR_MCID      5.10.573
symbol VIMS_793D_PAYLD_PAR_MCID      5.11.523
symbol VIMS_797A_PAYLD_PAR_MCID      5.12.523
symbol VIMS_994F_PAYLD_PAR_MCID      5.14.573
symbol VIMS_797F_PAYLD_PAR_MCID      5.15.524
symbol PLM_PAYLD_PAR_MCID            2.1.10

symbol VIMS_GEN_GNDSPD_PAR_MCID      5.1.514
symbol VIMS_797B_GNDSPD_PAR_MCID     5.2.514
symbol VIMS_785B_GNDSPD_PAR_MCID     5.3.520
symbol VIMS_785C_GNDSPD_PAR_MCID     5.4.520
symbol VIMS_789B_GNDSPD_PAR_MCID     5.5.520
symbol VIMS_789B0700_GNDSPD_PAR_MCID 5.6.520
symbol VIMS_793B_GNDSPD_PAR_MCID     5.7.520
symbol VIMS_793C_GNDSPD_PAR_MCID     5.8.520
symbol VIMS_793C0700_GNDSPD_PAR_MCID 5.9.520
symbol VIMS_994D_GNDSPD_PAR_MCID     5.10.532
symbol VIMS_793D_GNDSPD_PAR_MCID     5.11.520
symbol VIMS_797A_GNDSPD_PAR_MCID     5.12.514
symbol VIMS_994F_GNDSPD_PAR_MCID     5.14.532
symbol VIMS_797F_GNDSPD_PAR_MCID     5.15.520
symbol PLM_GNDSPD_PAR_MCID           2.1.6

# Event MineCare IDs (default to general model)
symbol PLM_RUNWLOAD_EVENT      33619976
symbol PLM_RUNNOLOAD_EVT       33619974
symbol VIMS_BDYUP_INA_EVT      83959406
symbol VIMS_BDYUP_ACT_EVT      83959407
symbol VIMS_DIPPER_EVT         83971616
symbol VIMS_LOAD_EVT           83971617
symbol VIMS_CYCLE_EVT          83971618
symbol PLM_DUMP_EVENT          33619969
symbol PLM_DUMPING_EVENT       33619978
symbol UNITRIG_LOAD_EVT	       1191257873
symbol UNITRIG_DUMP_EVT        1191257874
#######################################

# Default to VIMS-GEN
symbol DIPPER_EVENT       0
symbol PAYLOAD_PARAM      0
symbol GNDSPD_PARAM       0
symbol HCA_case           0
symbol availDriver        none
symbol payload	          N/A
symbol payload_avail      yes
symbol velocity
symbol isVelLessThanOne   no
symbol isVelGreatThanOne  no
symbol distance
symbol truck_loc
symbol gnd_speed
symbol okToSendDepart     no
symbol okToArrive	  yes
symbol dipperEvtRcv       no
symbol lastDipperTime	0
symbol currDipperTime	0
symbol lastDipperHour	0
symbol dipperValue	0
symbol dipperTimeDiff
symbol plmRunWLdEvtRcv    no
symbol vimsBdyUpActEvtRcv no
symbol vimsBdyUpInaEvtRcv no
symbol plmDumpEvtRcv      no
symbol plmDumpingEvtRcv   no
symbol plmRunNoLoad       no
symbol intfAutoArrv       yes
symbol lastDigInp0	0
symbol lastDigInp1	0	
symbol lastDigInp2	0	
symbol lastDigInp3	0
symbol lastDigInp4	0
symbol digInp0		0	
symbol digInp1		0
symbol digInp2		0
symbol digInp3		0	
symbol digInp4		0
symbol isDigInpAvail      no
symbol okToCheckDin       no
symbol dinSwitchActive	  no
symbol autoBktOn          no
symbol autoFullOn         no
symbol autoFullAssignOn   no
symbol autoArrvOn         no
symbol autoAssignOn       no
symbol WMautoBucket       no
symbol WMautoArrive       no
symbol WMautoFull         no
symbol WMautoFullAssign   no
symbol WMautoAssign       no
symbol WMdipperRcv        no
symbol WMplmRunWLoad      no
symbol WMvimsBdyAct       no
symbol WMvimsBdyInac      no
symbol WMstartAutoCycle   no
symbol driverIds
symbol shovelStat         0
symbol shovelBcn          ''
symbol shovelPos          none
symbol shovNxtQTrk
symbol updateFromCentral  0
symbol depart_bcn
symbol LDloc_type
symbol LDloc_valid
symbol hca_safemode		0
symbol hcaInit
symbol hcadebug		  0
symbol hcadbgmode	  2
symbol hcadbgmsg1
symbol hcadbgmsg2
symbol gpsArriveRcv  no
symbol hcaSimOn		0
symbol sim_gnd_speed	0
symbol sim_distance	100
symbol sim_velocity	0
symbol sim_dirTravel	forward
symbol sim_payload	0
symbol sim_xLoc		0
symbol sim_yLoc		0
symbol loadPos		none

in HCADBG 0x9990	ss	eq? $(hcadbgmode) 1 w0.Text write:'$1: $2\n';hcadbgmsg1 $1;hcadbgmsg2 $2;eq? $(hcadbgmode) 2 echo '$(hcadbgmsg1): $(hcadbgmsg2)'
symbol hcaActDebug.2	"READY"
symbol hcaActDebug.5	"ASSIGN"
symbol hcaActDebug.6	"ARRIVE"
symbol hcaActDebug.7	"LOAD"
symbol hcaActDebug.8	"LOGON"
symbol hcaActDebug.12	"FULL"
symbol hcaActDebug.9	"WAIT"
symbol hcaActDebug.0	"NONPROD"

############################
# Initialization
############################
#if !#option(StoreForward)
macro HCA_rpc_extra kstate_extra $(kstate_extra) SF HCA
#else
macro HCA_rpc_extra kstate_extra $(kstate_extra) HCA
#endif
macro  initHCA         WinMgr after:$(DRIVERS_DELAY_CHECK):checkDrivers;\
                       checkDinInp;\
                       ne? $(WMstartAutoCycle) yes startAutoCycle;\
                       hcaInit 1;HCA_rpc_extra

macro  checkDrivers    driverIds $(adap driverIds); foreach $(driverIds); do getDriverId;\
                       ne? WMstartAutoCycle yes ne? $(availDriver) none startAutoCycle;

macro  getDriverId     eq? $(availDriver) none eq? $2 $(VIMS_GEN_DRIVER_ID) vimsGenSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_797B_DRIVER_ID) vims797BSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_785B_DRIVER_ID) vims785BSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_785C_DRIVER_ID) vims785CSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_789B_DRIVER_ID) vims789BSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_789B0700_DRIVER_ID) vims789B0Setts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_793B_DRIVER_ID) vims793BSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_793C_DRIVER_ID) vims793CSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_793C0700_DRIVER_ID) vims793C0Setts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_994D_DRIVER_ID) vims994DSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_793D_DRIVER_ID) vims793DSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_797A_DRIVER_ID) vims797ASetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_994F_DRIVER_ID) vims994FSetts;\
                       eq? $(availDriver) none eq? $2 $(VIMS_797F_DRIVER_ID) vims797FSetts;\
                       eq? $(availDriver) none eq? $2 $(PLM_GEN_DRIVER_ID) plmGenSetts;\
                       eq? $(availDriver) none eq? $2 $(UNITRIG_GEN_DRIVER_ID) unitRigGenSetts;					   
					   
macro  vimsGenSetts    availDriver $(VIMS_GEN_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 83952139; GNDSPD_PARAM 83952130;\
                       adap request:$(VIMS_GEN_PAYLD_PAR_MCID); adap request:$(VIMS_GEN_GNDSPD_PAR_MCID);

macro  vims797BSetts   availDriver $(VIMS_797B_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84017675; GNDSPD_PARAM 84017666;\
                       adap request:$(VIMS_797B_PAYLD_PAR_MCID); adap request:$(VIMS_797B_GNDSPD_PAR_MCID);

macro  vims785BSetts   availDriver $(VIMS_785B_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84083211; GNDSPD_PARAM 84083208;\
                       adap request:$(VIMS_785B_PAYLD_PAR_MCID); adap request:$(VIMS_785B_GNDSPD_PAR_MCID);

macro  vims785CSetts   availDriver $(VIMS_785C_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84148747; GNDSPD_PARAM 84148744;\
                       adap request:$(VIMS_785C_PAYLD_PAR_MCID); adap request:$(VIMS_785C_GNDSPD_PAR_MCID);

macro  vims789BSetts   availDriver $(VIMS_789B_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84214283; GNDSPD_PARAM 84214280;\
                       adap request:$(VIMS_789B_PAYLD_PAR_MCID); adap request:$(VIMS_789B_GNDSPD_PAR_MCID);

macro  vims789B0Setts  availDriver $(VIMS_789B0700_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84279819; GNDSPD_PARAM 84279816;\
                       adap request:$(VIMS_789B070_PAYLD_PAR_MCID); adap request:$(VIMS_789B0700_GNDSPD_PAR_MCID);

macro  vims793BSetts   availDriver $(VIMS_793B_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84345355; GNDSPD_PARAM 84345352;\
                       adap request:$(VIMS_793B_PAYLD_PAR_MCID); adap request:$(VIMS_793B_GNDSPD_PAR_MCID);

macro  vims793CSetts   availDriver $(VIMS_793C_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84410891; GNDSPD_PARAM 84410888;\
                       adap request:$(VIMS_793C_PAYLD_PAR_MCID); adap request:$(VIMS_793C_GNDSPD_PAR_MCID);

macro  vims793C0Setts  availDriver $(VIMS_793C0700_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84476427; GNDSPD_PARAM 84476424;\
                       adap request:$(VIMS_793C0700_PAYLD_PAR_MCID); adap request:$(VIMS_793C_GNDSPD_PAR_MCID);

macro  vims994DSetts   availDriver $(VIMS_994D_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84542013; GNDSPD_PARAM 84541972;\
                       adap request:$(VIMS_994D_PAYLD_PAR_MCID); adap request:$(VIMS_994D_GNDSPD_PAR_MCID);

macro  vims793DSetts   availDriver $(VIMS_793D_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84607499; GNDSPD_PARAM 84607496;\
                       adap request:$(VIMS_793D_PAYLD_PAR_MCID); adap request:$(VIMS_793D_GNDSPD_PAR_MCID);

macro  vims797ASetts   availDriver $(VIMS_797A_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84673035; GNDSPD_PARAM 84673026;\
                       adap request:$(VIMS_797A_PAYLD_PAR_MCID); adap request:$(VIMS_797A_GNDSPD_PAR_MCID);

macro  vims994FSetts   availDriver $(VIMS_994F_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84804157; GNDSPD_PARAM 84804116;\
                       adap request:$(VIMS_994F_PAYLD_PAR_MCID); adap request:$(VIMS_994F_GNDSPD_PAR_MCID);

macro  vims797FSetts   availDriver $(VIMS_797F_DRIVER_ID); DIPPER_EVENT $(VIMS_DIPPER_EVT);\
                       PAYLOAD_PARAM 84869644; GNDSPD_PARAM 84869640;\
                       adap request:$(VIMS_797F_PAYLD_PAR_MCID); adap request:$(VIMS_797F_GNDSPD_PAR_MCID);

macro  plmGenSetts     availDriver $(PLM_GEN_DRIVER_ID); DIPPER_EVENT 33619968; PAYLOAD_PARAM 33619978;\
                       GNDSPD_PARAM 33619974; adap request:$(PLM_PAYLD_PAR_MCID); adap request:$(PLM_GNDSPD_PAR_MCID);
					   
macro  unitRigGenSetts availDriver $(UNITRIG_GEN_DRIVER_ID);payload_avail no;payload 100;DIPPER_EVENT 1191257872;

macro  startAutoCycle  WMstartAutoCycle no;eq? $(hcadebug) 1 HCADBG "startAutoCycle" "at $(FormatDate)";\
                       ne? $(availDriver) none ne? $(availDriver) $(PLM_GEN_DRIVER_ID) eq? $(sfnextact) $(SF_FULL) autoFullOn yes;\
                       eq? $(sfnextact) $(SF_LOAD) autoBktOn yes;\
                       eq? $(sfnextact) $(SF_ARRIVE) autoArrvOn yes;\
                       eq? $(sfnextact) $(SF_ASSIGN) autoAssignOn yes;\
                       eq? $(sfnextact) '' contAutoCycle;\
                       eq? $(autoBktOn) yes ne? $(WMautoBucket) yes autoBucket;\
                       eq? $(autoFullOn) yes ne? $(WMautoFull) yes autoFull;\
                       eq? $(autoArrvOn) yes eq? $(isDigInpAvail) yes checkDumpSwitch;\
                       eq? $(autoAssignOn) yes eq? $(isDigInpAvail) yes checkDumpSwitch;
macro contAutoCycle    WMstartAutoCycle yes; WinMgr after:$(CASE_RETRY_TIME):startAutoCycle;

macro stopAutoCycle    availDriver none;\
                       isDigInpAvail no;\
                       autoBktOn no;\
                       autoArrvOn no;\
                       autoAssignOn no;\
                       autoFullOn no;\
                       autoFullAssignOn no;\
                       hcaInit 0;

######################################
# Haul-Cycle Automation Cases
######################################

out    VS-GCEVENT        0x0774 l?f	ne? $(availDriver) none checkEventId

macro  checkEventId    eq? $(hcadebug) 1 HCADBG "checkEventId-" "event:$1";\
                       eq? $1 $(DIPPER_EVENT) ne? $(WMdipperRcv) yes dipperCheck;\
                       eq? $1 $(PLM_RUNWLOAD_EVENT) ne? $(WMplmRunWLoad) yes plmRunWLoadRcv;\
                       eq? $1 $(VIMS_BDYUP_ACT_EVT) ne? $(WMvimsBdyAct) yes vimsBdyActRcv;\
                       eq? $1 $(VIMS_BDYUP_INA_EVT) ne? $(WMvimsBdyInac) yes vimsBdyInacRcv;\
                       eq? $1 $(PLM_DUMP_EVENT) plmDumpAct;\
                       eq? $1 $(PLM_DUMPING_EVENT) HandleDumpingEvt;\
                       eq? $1 $(PLM_RUNNOLOAD_EVT) HandleRunNoLoadEvt;\
                       eq? $1 $(UNITRIG_LOAD_EVT) plmRunWLoadRcv;\
                       eq? $1 $(UNITRIG_DUMP_EVT) eq? $(USE_UNITRIG_DUMP_EVT) yes HandleRunNoLoadEvt;\
                       eq? $1 $(UNITRIG_DUMP_EVT) ne? $(USE_UNITRIG_DUMP_EVT) yes HCADBG "UnitRig dump event" "support disabled";
				   
macro HandleDumpingEvt	plmRunNoLoad no;plmRunWLdEvtRcv no;plmDumpingEvtRcv yes;plmDumpAct
macro HandleRunNoLoadEvt	plmDumpingEvtRcv no;plmRunWLdEvtRcv no;plmRunNoLoad yes;plmDumpAct

macro SetDipperValue   dipperValue $2;\
                       eq? $(hcadebug) 1 HCADBG "Dipper Value (min)" "$(dipperValue) ($(HCA_DIPPER_MIN))";
macro SetCurDipTime    currDipperTime $(+ $(Time second) $(* $(Time minute) 60));ne? $(lastDipperHour) $(Time hour) lastDipperTime $(- $(lastDipperTime) 3600);
macro SetDipperTime    SetCurDipTime;dipperTimeDiff $(- $(currDipperTime) $(lastDipperTime));lastDipperTime $(currDipperTime);lastDipperHour $(Time hour);\
                       eq? $(hcadebug) 1 HCADBG "Dipper Time Diff (min)" "$(dipperTimeDiff) ($(HCA_DIPPER_TIMEOUT))";
macro dipperCheck      SetDipperValue;SetDipperTime;\
                       ne? $(max $(dipperValue) $(HCA_DIPPER_MIN)) $(HCA_DIPPER_MIN) ne? $(max $(dipperTimeDiff) $(HCA_DIPPER_TIMEOUT)) $(HCA_DIPPER_TIMEOUT) dipperRcv 
macro  dipperRcv       eq? $(hcadebug) 1 HCADBG "dipperRcv-" "nextact:$(sfnextact) at $(FormatDate)";\
                       eq? $(intfAutoArrv) yes eq? $(commstat) yes eq? $(sfnextloc) shovel eq? $(sfnextact) $(SF_ARRIVE) HCA_case $(CONN_ARR_SHOV);\
                       eq? $(intfAutoArrv) yes eq? $(commstat) no eq? $(sfnextloc) shovel eq? $(sfnextact) $(SF_ARRIVE) HCA_case $(ARR_SHOV);\
                       eq? $(commstat) yes eq? $(sfnextact) $(SF_LOAD) HCA_case $(CONN_BKT_INTERFACE);\
                       eq? $(commstat) no eq? $(sfnextact) $(SF_LOAD) HCA_case $(BKT_INTERFACE);\
                       dipperEvtRcv yes;\
                       eq? $(HCA_case) $(CONN_ARR_SHOV) checkLocType;\
                       eq? $(HCA_case) $(ARR_SHOV) checkLocType;\
                       eq? $(HCA_case) $(CONN_BKT_INTERFACE) checkPayload;\
                       eq? $(HCA_case) $(BKT_INTERFACE) checkPayload;\
                       eq? $(sfnextloc) dump dipperEvtRcv no;\
					   eq? $(sfnextact) $(SF_FULL) dipperEvtRcv no;\
					   WMdipperRcv no;\
                       eq? $(dipperEvtRcv) yes contdipperRcv;
macro  contdipperRcv   WMdipperRcv yes;WinMgr after:$(CASE_RETRY_TIME):dipperRcv;					   

macro  plmRunWLoadRcv  plmDumpingEvtRcv no;plmRunNoLoad no;plmRunWLdEvtRcv yes;\
                       eq? $(commstat) yes HCA_case $(CONN_FULL_PLM);eq? $(commstat) no HCA_case $(FULL_PLM);\
                       eq? $(sfnextact) $(SF_FULL) checkLocType;\
                       ne? $(sfnextact) $(SF_FULL) plmRunWLdEvtRcv no;\
					   WMplmRunWLoad no;\
                       eq? $(plmRunWLdEvtRcv) yes contplmRunWLoad;
macro  contplmRunWLoad WMplmRunWLoad yes;WinMgr after:$(CASE_RETRY_TIME):plmRunWLoadRcv;					   

macro  vimsBdyActRcv   vimsBdyUpActEvtRcv yes; eq? $(commstat) yes HCA_case $(CONN_ARR_DUMP_VIMS);\
                       eq? $(commstat) no HCA_case $(ARR_DUMP_VIMS); checkLocType;\
                       WMvimsBdyAct no;\
                       eq? $(vimsBdyUpActEvtRcv) yes contvimsBdyAct;
macro  contvimsBdyAct  WMvimsBdyAct yes;WinMgr after:$(CASE_RETRY_TIME):vimsBdyActRcv;

macro  vimsBdyInacRcv  vimsBdyUpInaEvtRcv yes; eq? $(commstat) yes HCA_case $(CONN_ASSIGN_VIMS);\
                       WMvimsBdyInac no;\
                       eq? $(commstat) no HCA_case $(ASSIGN_VIMS); checkDirTravel$(hcaSimOn);\
                       eq? $(vimsBdyUpInaEvtRcv) yes contvimsBdyInac;
macro  contvimsBdyInac WMvimsBdyInac yes;WinMgr after:$(CASE_RETRY_TIME):vimsBdyInacRcv;

macro  plmDumpAct      plmDumpEvtRcv yes;\
                       eq? $(plmRunNoLoad) yes eq? $(commstat) yes HCA_case $(CONN_ASSIGN_PLM);\
                       eq? $(plmRunNoLoad) yes eq? $(commstat) no HCA_case $(ASSIGN_PLM);\
                       eq? $(plmDumpingEvtRcv) yes eq? $(commstat) yes HCA_case $(CONN_ARR_DUMP_PLM);\
                       eq? $(plmDumpingEvtRcv) yes eq? $(commstat) no HCA_case $(ARR_DUMP_PLM);\
                       eq? $(plmDumpingEvtRcv) yes eq? $(hcadebug) 1 HCADBG "plmDumpAct-Dumping" "HCA_case:$(hcaCaseDebug.$(HCA_case))";\
                       eq? $(plmRunNoLoad) yes eq? $(hcadebug) 1 HCADBG "plmDumpAct-RunNoLoad" "HCA_case:$(hcaCaseDebug.$(HCA_case))";\
                       eq? $(HCA_case) $(CONN_ASSIGN_PLM) eq? $(sfnextact) $(SF_ASSIGN) checkLocType;\
                       eq? $(HCA_case) $(ASSIGN_PLM) eq? $(sfnextact) $(SF_ASSIGN) checkLocType;\
                       eq? $(HCA_case) $(CONN_ARR_DUMP_PLM) eq? $(sfnextact) $(SF_ARRIVE) eq? $(sfnextloc) dump checkLocType;\
                       eq? $(HCA_case) $(ARR_DUMP_PLM) eq? $(sfnextact) $(SF_ARRIVE) eq? $(sfnextloc) dump checkLocType;

macro  checkPayload    eq? $(hcaSimOn) 0 eq? $(payload_avail) yes payload $(adap paramVal:$(PAYLOAD_PARAM)); eq? $(hcaSimOn) 1 payload $(sim_payload);\
                       ne? $(payload) N/A ne? $(max $(payload) $(MIN_PAYLOAD)) $(MIN_PAYLOAD) checkNxtAct;

macro  checkNxtAct     eq? $(hcadebug) 1 HCADBG "checkNxtAct-" "nxtact:$(hcaActDebug.$(sfnextact))";\
                       eq? $(sfnextact) $(SF_LOAD) checkVelocity;\
                       eq? $(sfnextact) $(SF_FULL) checkLocType;\
                       eq? $(sfnextact) $(SF_ARRIVE) checkLocType;\
                       eq? $(sfnextact) $(SF_ASSIGN) eq? $(HCA_case) $(CONN_ASSIGN_DIN) hcaAssign;\
                       eq? $(sfnextact) $(SF_ASSIGN) eq? $(HCA_case) $(ASSIGN_DIN) hcaAssign;

macro  hcaAssign       eq? $(hcadebug) 1 HCADBG "hcaAssign-" "HCA_case:$(hcaCaseDebug.$(HCA_case)) state:$(state)";\
                       eq? $(HCA_case) $(CONN_ASSIGN) eq? $(state) 10 okToSendDepart yes;\
                       eq? $(HCA_case) $(CONN_ASSIGN) eq? $(state) 2 ASSIGN -1;\
                       ne? $(HCA_case) $(CONN_ASSIGN) ASSIGN -1;\
                       hcaAfterAssign;

macro  hcaAfterAssign  autoAssignOn no; vimsBdyUpInaEvtRcv no; autoFullAssignOn no; dinSwitchActive no;\
                       plmDumpEvtRcv no; plmRunNoLoad no; gpsArriveRcv no; HCA_case $(INVALID_CASE);

macro  checkVelocity   eq? $(hcadebug) 1 HCADBG "checkVelocity-" "HCA_case:$(hcaCaseDebug.$(HCA_case))";\
                       isVelLessThanOne no; isVelGreatThanOne no;\
                       eq? $(hcaSimOn) 0 velocity $(GpsTruck velocity); eq? $(hcaSimOn) 1 velocity $(sim_velocity);\
                       eq? $(hcadebug) 1 HCADBG "velocity" "$(velocity)";\
                       eq? $(min $(velocity) $(MIN_VELOCITY)) $(velocity) isVelLessThanOne yes;\
                       eq? $(max $(velocity) $(MIN_VELOCITY)) $(velocity) isVelGreatThanOne yes;\
                       eq? $(HCA_case) $(CONN_BKT_INTERFACE) eq? $(isVelLessThanOne) yes hcaLoad;\
                       eq? $(HCA_case) $(BKT_INTERFACE) eq? $(isVelLessThanOne) yes hcaLoad;\
                       eq? $(HCA_case) $(CONN_FULL) eq? $(isVelGreatThanOne) yes hcaFull;\
                       eq? $(HCA_case) $(HCA_FULL) eq? $(isVelGreatThanOne) yes checkLocType;\
                       eq? $(HCA_case) $(CONN_ASSIGN) eq? $(isVelGreatThanOne) yes hcaAssign;\
                       eq? $(HCA_case) $(HCA_ASSIGN) eq? $(isVelGreatThanOne) yes hcaAssign;\
                       eq? $(isVelLessThanOne) yes ne? $(HCA_case) $(CONN_BKT_INTERFACE) ne? $(HCA_case) $(BKT_INTERFACE) ne? $(HCA_case) $(CONN_FULL) ne? $(HCA_case) $(HCA_FULL) ne? $(HCA_case) $(CONN_ASSIGN) ne? $(HCA_case) $(HCA_ASSIGN) checkLocType;

macro  checkDistance   eq? $(hcaSimOn) 0 distance $(GpsTruck distance:$(shovelPos)); eq? $(hcaSimOn) 1 distance $(sim_distance);\
                       eq? $(hcadebug) 1 HCADBG "checkDistance-" "dist:$(distance)";\
                       eq? $(min $(distance) $(MIN_DISTANCE)) $(distance) checkNxtAct;

macro  checkDestination  ne? "$(loc_id)" "$(dest)" checkDestFail;\
                         eq? $(hcadebug) 1 HCADBG "checkDestination-" "$(loc_id):$(dest)"
macro  checkDestFail   okToArrive no;\
                       eq? $(HCA_CHECK_DEST_WARN) yes EQ-REQ "hca-info" [ "checkDest" "$(loc_id)" "$(dest)" ]

macro  checkLocType    eq? $(hcadebug) 1 HCADBG "checkLocType-" "LDloc_type:$(LDloc_type) HCA_case:$(hcaCaseDebug.$(HCA_case)) sfnextloc:$(sfnextloc)";\
                       checkLocType.$(HCA_case);
macro  checkLocType.0  nil
# HCA_case CONN_BKT
macro  checkLocType.2  eq? $(LDloc_type) $(UNIT_BLAST) getLocation;\
                       eq? $(LDloc_type) $(UNIT_SHOVEL) getLocation;
# HCA_case HCA_BKT
macro  checkLocType.16 eq? $(LDloc_type) $(UNIT_BLAST) getLocation;\
                       eq? $(LDloc_type) $(UNIT_SHOVEL) getLocation;
# HCA_case CONN_FULL_VIMS
macro  checkLocType.3  ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_BLAST) checkDirTravel$(hcaSimOn);\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_SHOVEL) checkDirTravel$(hcaSimOn);\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_STOCKPILE) checkDirTravel$(hcaSimOn);\
                       eq? $(sfnextloc) shovel checkDirTravel$(hcaSimOn);
# HCA_case FULL_VMS
macro  checkLocType.17 ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_BLAST) checkDirTravel$(hcaSimOn);\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_SHOVEL) checkDirTravel$(hcaSimOn);\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_STOCKPILE) checkDirTravel$(hcaSimOn);\
                       eq? $(sfnextloc) shovel checkDirTravel$(hcaSimOn);
# HCA_case CONN_FULL_PLM
macro  checkLocType.4  ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_BLAST) executeAction;\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_SHOVEL) executeAction;\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_STOCKPILE) executeAction;\
                       eq? $(sfnextloc) shovel executeAction;
# HCA_case FULL_PLM
macro  checkLocType.18 ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_BLAST) executeAction;\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_SHOVEL) executeAction;\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_STOCKPILE) executeAction;\
                       eq? $(sfnextloc) shovel executeAction;
# HCA_case CONN_FULL
macro  checkLocType.5  eq? $(LDloc_type) $(UNIT_BLAST) checkVelocity;\
                       eq? $(LDloc_type) $(UNIT_SHOVEL) checkVelocity;\
                       eq? $(LDloc_type) $(UNIT_STOCKPILE) checkVelocity;
# HCA_case HCA_FULL
macro  checkLocType.19 eq? $(LDloc_type) $(UNIT_BLAST) hcaFull;\
                       eq? $(LDloc_type) $(UNIT_SHOVEL) hcaFull;\
                       eq? $(LDloc_type) $(UNIT_STOCKPILE) hcaFull;
# HCA_case CONN_ARR_DUMP_VIMS
macro  checkLocType.6  ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_DUMP) checkDirTravel$(hcaSimOn);\
                       ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_CRUSHER) checkDirTravel$(hcaSimOn);\
                       eq? $(sfnextloc) dump checkDirTravel$(hcaSimOn);
# HCA_case ARR_DUMP_VIMS
macro  checkLocType.20 ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_DUMP) checkDirTravel$(hcaSimOn);\
                       ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_CRUSHER) checkDirTravel$(hcaSimOn);\
                       eq? $(sfnextloc) dump checkDirTravel$(hcaSimOn);
# HCA_case CONN_ARR_DUMP_PLM
macro  checkLocType.7  ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_DUMP) hcaArrive;\
                       ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_CRUSHER) hcaArrive;\
                       eq? $(sfnextloc) dump hcaArrive;
# HCA_case ARR_DUMP_PLM
macro  checkLocType.21 ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_DUMP) hcaArrive;\
                       ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_CRUSHER) hcaArrive;\
                       eq? $(sfnextloc) dump hcaArrive;
# HCA_case CONN_ARR_DUMP_DIN
macro  checkLocType.8  ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_DUMP) hcaArrive;\
                       ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_CRUSHER) hcaArrive;\
                       eq? $(sfnextloc) dump hcaArrive;
# HCA_case ARR_DUMP_DIN
macro  checkLocType.22 ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_DUMP) hcaArrive;\
                       ne? $(sfnextloc) dump eq? $(LDloc_type) $(UNIT_CRUSHER) hcaArrive;\
                       eq? $(sfnextloc) dump hcaArrive;
# HCA_case CONN_ARR_DUMP
macro  checkLocType.9  eq? $(LDloc_type) $(UNIT_DUMP) hcaArrive;\
                       eq? $(LDloc_type) $(UNIT_CRUSHER) hcaArrive;
# HCA_case ARR_DUMP
macro  checkLocType.23 eq? $(LDloc_type) $(UNIT_DUMP) hcaArrive;\
                       eq? $(LDloc_type) $(UNIT_CRUSHER) hcaArrive;
# HCA_case CONN_ASSIGN_PLM
macro  checkLocType.11 eq? $(LDloc_type) $(UNIT_DUMP) hcaAssign;\
                       eq? $(LDloc_type) $(UNIT_CRUSHER) hcaAssign;
# HCA_case ASSIGN_PLM
macro  checkLocType.25 eq? $(LDloc_type) $(UNIT_DUMP) hcaAssign;\
                       eq? $(LDloc_type) $(UNIT_CRUSHER) hcaAssign;
# HCA_case CONN_ARR_SHOV
macro  checkLocType.14 ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_BLAST) hcaArrvShov;\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_SHOVEL) hcaArrvShov;\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_STOCKPILE) hcaArrvShov;\
                       eq? $(sfnextloc) shovel hcaArrvShov;
# HCA_case ARR_SHOV
macro  checkLocType.28 ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_BLAST) hcaArrvShov;\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_SHOVEL) hcaArrvShov;\
                       ne? $(sfnextloc) shovel eq? $(LDloc_type) $(UNIT_STOCKPILE) hcaArrvShov;\
                       eq? $(sfnextloc) shovel hcaArrvShov;


macro  hcaArrvShov     eq? $(sfnextloc) shovel LDloc_type $(UNIT_SHOVEL);\
                       eq? $(gpsArriveRcv) yes eq? $(HCA_CHECK_DEST) yes checkDestination;\
                       eq? $(commstat) yes eq? $(loc_auto) 0 eq? $(okToArrive) yes ARRIVE -1;\
                       eq? $(commstat) no eq? $(okToArrive) yes ARRIVE -1;\
                       hcaAfterArrvSh;

macro  hcaAfterArrvSh  dipperEvtRcv no; autoArrvOn no; okToArrive yes; HCA_case $(INVALID_CASE);\
                       autoBktOn yes; ne? $(WMautoBucket) yes autoBucket;

macro  hcaFullOLD         eq? $(hcadebug) 1 HCADBG "hcaFull" "";\
                       eq? $(commstat) yes eq? $(availDriver) none okToSendDepart yes;\
                       ne? $(availDriver) none SendTrkFull;\
                       eq? $(commstat) no eq? $(availDriver) none SendTrkFull;\
                       eq? $(commstat) yes eq? $(HCA_GPS_FULL_LOGIC) on SendTrkFull;

macro  hcaFull         eq? $(hcadebug) 1 HCADBG "hcaFull" "";\
                       eq? $(commstat) yes eq? $(availDriver) none okToSendDepart yes;\
                       SendTrkFull;

macro  hcaAfterFull    autoBktOn no; autoFullOn no; autoFullAssignOn no; plmRunWLdEvtRcv no; shovNxtQTrk '';\
                       gpsArriveRcv no; shovelStat $(STATUS_NONE); loadPos none;\
                       eq? $(isDigInpAvail) yes autoArrvOn yes; eq? $(autoArrvOn) yes checkDumpSwitch;\
                       HCA_case $(INVALID_CASE);

macro  hcaArrive       eq? $(hcadebug) 1 HCADBG "hcaArrive-" "NextLoc:$(sfnextloc)";\
                       eq? $(sfnextloc) dump LDloc_type $(UNIT_DUMP);\
                       eq? $(sfnextloc) shovel LDloc_type $(UNIT_SHOVEL);\
                       eq? $(gpsArriveRcv) yes eq? $(HCA_CHECK_DEST) yes checkDestination;\
                       eq? $(commstat) yes eq? $(gpsArriveRcv) yes eq? $(loc_auto) 0 eq? $(okToArrive) yes ARRIVE -1;\
                       eq? $(commstat) no eq? $(gpsArriveRcv) yes eq? $(okToArrive) yes ARRIVE -1;\
                       eq? $(gpsArriveRcv) no eq? $(okToArrive) yes ARRIVE -1;\
                       hcaAfterArrive;

macro  hcaAfterArrive  eq? $(hcadebug) 1 HCADBG "hcaAfterArrive" "";\
                       autoArrvOn no; autoAssignOn yes; okToArrive yes;\
                       eq? $(isDigInpAvail) yes checkDumpSwitch;\
                       vimsBdyUpActEvtRcv no; plmDumpEvtRcv no; plmDumpingEvtRcv no; HCA_case $(INVALID_CASE);


macro  checkTruckInQ   eq? $(shovNxtQTrk) $(OMS host) ne? $(shovelPos) none checkDistance;

macro  getLocation     eq? $(last_loadloc) $(dest) checkEqmtStat;

macro  checkEqmtStat   eq? $(HCA_case) $(CONN_BKT) eq? $(shovelStat) $(STATUS_READY) hcaLoad;\
                       eq? $(HCA_case) $(HCA_BKT) hcaLoad;

macro  hcaLoad         eq? $(hcadebug) 1 HCADBG "hcaLoad" "state:$(state)";\
                       ne? $(state) 17 ne? $(state) 8 LOAD -1; hcaAfterLoad;

macro  hcaAfterLoad    dipperEvtRcv no; autoBktOn no; HCA_case $(INVALID_CASE); shovNxtQTrk ''; shovelStat $(STATUS_NONE);\
                       distance ''; autoFullOn yes;loadPos $(GpsTruck x),$(GpsTruck y);\
                       shovelPos none; eq? $(autoFullOn) yes ne? $(WMautoFull) yes WinMgr after:$(CASE_RETRY_TIME):autoFull;

macro  autoFull        eq? $(hcadebug) 1 HCADBG "autoFull" "HCA_case:$(hcaCaseDebug.$(HCA_case)) at $(FormatDate)";\
                       eq? $(HCA_case) $(INVALID_CASE) eq? $(commstat) yes HCA_case $(CONN_FULL_VIMS);\
                       eq? $(HCA_case) $(INVALID_CASE) eq? $(commstat) no HCA_case $(FULL_VIMS);\
                       checkNxtAct;\
                       WMautoFull no;\
                       eq? $(HCA_case) $(CONN_FULL_VIMS) eq? $(autoFullOn) yes contautoFull;\
                       eq? $(HCA_case) $(FULL_VIMS) eq? $(autoFullOn) yes contautoFull;
macro  contautoFull    WMautoFull yes;WinMgr after:$(CASE_RETRY_TIME):autoFull;					   

macro  checkDirTravel0 eq? $(HCA_SKIP_DIRTRAV) no eq? $(GpsTruck dirTravel) forward checkGrdSpeed;\
                       eq? $(HCA_SKIP_DIRTRAV) yes ne? $(HCA_case) $(CONN_ARR_DUMP_VIMS) ne? $(HCA_case) $(ARR_DUMP_VIMS) checkGrdSpeed;\
                       eq? $(HCA_case) $(CONN_ARR_DUMP_VIMS) eq? "$(GpsTruck dirTravel)" "unknown" hcaArrive;\
                       eq? $(HCA_case) $(CONN_ARR_DUMP_VIMS) eq? "$(GpsTruck dirTravel)" "neutral" hcaArrive;\
                       eq? $(HCA_case) $(ARR_DUMP_VIMS) eq? "$(GpsTruck dirTravel)" "unknown" hcaArrive;\
                       eq? $(HCA_case) $(ARR_DUMP_VIMS) eq? "$(GpsTruck dirTravel)" "neutral" hcaArrive;

macro  checkDirTravel1 eq? $(sim_dirTravel) forward checkGrdSpeed;\
                       eq? $(HCA_case) $(CONN_ARR_DUMP_VIMS) eq? "$(sim_dirTravel)" "unknown" hcaArrive;\
                       eq? $(HCA_case) $(CONN_ARR_DUMP_VIMS) eq? "$(sim_dirTravel)" "neutral" hcaArrive;\
                       eq? $(HCA_case) $(ARR_DUMP_VIMS) eq? "$(sim_dirTravel)" "unknown" hcaArrive;\
                       eq? $(HCA_case) $(ARR_DUMP_VIMS) eq? "$(sim_dirTravel)" "neutral" hcaArrive;

macro  checkGrdSpeed   ne? $(GNDSPD_PARAM) 0 eq? $(hcaSimOn) 0 gnd_speed $(adap paramVal:$(GNDSPD_PARAM)); eq? $(hcaSimOn) 1 gnd_speed $(sim_gnd_speed);\
                       eq? $(GNDSPD_PARAM) 0 eq? $(hcaSimOn) 0 velocity $(GpsTruck velocity); eq? $(hcaSimOn) 1 velocity $(sim_velocity);\
                       ne? $(GNDSPD_PARAM) 0 eq? $(hcadebug) 1 HCADBG "checkGrdSpeed-" "Interface Ground Speed:$(gnd_speed)";\
		       eq? $(GNDSPD_PARAM) 0 eq? $(hcadebug) 1 HCADBG "checkGrdSpeed-" "GPS Ground Speed:$(velocity)";\
                       eq? $(HCA_GPS_FULL_LOGIC) on ne? $(GNDSPD_PARAM) 0 eq? $(max $(gnd_speed) $(MIN_GND_SPEED)) $(gnd_speed) checkFullDist;\
                       eq? $(HCA_GPS_FULL_LOGIC) on eq? $(GNDSPD_PARAM) 0 eq? $(max $(velocity) $(MIN_VELOCITY)) $(velocity) checkFullDist;\
                       eq? $(HCA_GPS_FULL_LOGIC) off ne? $(GNDSPD_PARAM) 0 eq? $(max $(gnd_speed) $(MIN_GND_SPEED)) $(gnd_speed) executeAction;\
                       eq? $(HCA_GPS_FULL_LOGIC) off eq? $(GNDSPD_PARAM) 0 eq? $(max $(velocity) $(MIN_VELOCITY)) $(velocity) executeAction;

macro  checkFullDist   eq? $(hcaSimOn) 0 distance $(GpsTruck distance:$(loadPos)); eq? $(hcaSimOn) 1 distance $(sim_distance);\
                       eq? $(hcadebug) 1 eq? $(hcaSimOn) 0 HCADBG "checkFullDist" "loadPos:$(loadPos) curPos:$(GpsTruck x),$(GpsTruck y)";\
                       eq? $(hcadebug) 1 HCADBG "checkFullDist" "dist:$(distance)";\
                       eq? $(max $(distance) $(MIN_DISTANCE)) $(distance) executeAction; 

macro  executeAction   eq? $(HCA_case) $(CONN_FULL_VIMS) hcaFull;\
                       eq? $(HCA_case) $(FULL_VIMS) hcaFull;\
                       eq? $(HCA_case) $(CONN_FULL_PLM) hcaFull;\
                       eq? $(HCA_case) $(FULL_PLM) hcaFull;\
                       eq? $(HCA_case) $(CONN_ASSIGN_VIMS) hcaAssign;\
                       eq? $(HCA_case) $(ASSIGN_VIMS) hcaAssign;

out    GPS-DEPART      0x01a7  ddd    depart_bcn $1; WinMgr after:1:setLDLoc;\
                       eq? $(commstat) no eq? $(hcaInit) 1 ne? $(WMautoFullAssign) yes autoFullAssign;\
                       sendto up spooled;

macro  autoFullAssign  eq? $(hcadebug) 1 HCADBG "autoFullAssign-" "DEPART BCN:$(depart_bcn) nxtact:$(sfnextact) LDloc_type:$(LDloc_type)";\
                       autoFullAssignOn yes;\
                       eq? $(sfnextact) $(SF_FULL) checkBeacon;\
                       eq? $(sfnextact) $(SF_ASSIGN) eq? $(commstat) yes HCA_case $(CONN_ASSIGN);\
                       eq? $(sfnextact) $(SF_ASSIGN) eq? $(commstat) no HCA_case $(HCA_ASSIGN);\
                       eq? $(HCA_case) $(CONN_ASSIGN) checkVelocity;\
                       eq? $(HCA_case) $(HCA_ASSIGN) checkVelocity;\
                       eq? $(hca_safemode) 1 ne? $(sfnextact) $(SF_FULL) ne? $(sfnextact) $(SF_ASSIGN) autoFullAssignOff;\
                       eq? $(hcadebug) 1 HCADBG "autoFullAssignOn" "$(autoFullAssignOn)";\
                       eq? $(hcadebug) 1 HCADBG "okToSendDepart" "$(okToSendDepart)\n";\
					   WMautoFullAssign no;\
                       eq? $(autoFullAssignOn) yes contautoFullAssign;
macro  contautoFullAssign  WMautoFullAssign yes;WinMgr after:$(CASE_RETRY_TIME):autoFullAssign;					   

macro  autoFullAssignOff eq? $(hcadebug) 1 HCADBG "autoFullAssign" "turned off"; autoFullAssignOn no

macro  checkBeacon     eq? $(hcadebug) 1 HCADBG "checkBeacon:" "sending hcaEqmtInfo at $(FormatDate)";\
                       eq? $(commstat) yes eq? $(shovelBcn) '' EQ-REQ "hcaEqmtInfo";\
                       eq? $(commstat) yes HCA_case $(CONN_FULL);\
                       eq? $(commstat) no HCA_case $(HCA_FULL);\
                       eq? $(HCA_case) $(CONN_FULL) eq? $(depart_bcn) $(shovelBcn) ne? $(WMautoFull) yes autoFull;\
                       eq? $(HCA_case) $(HCA_FULL) eq? $(locid.$(depart_bcn)) $(last_loadloc) checkVelocity;

out    GPS-ARRIVE      0x01a6  ddd?dd  last_beacon $1; LDloc_valid 0; WinMgr after:1:HandleBcnArr;gpsArriveRcv yes;\
                       eq? $(hcadebug) 1 HCADBG "GPS-ARRIVE" "at $(last_beacon)";\
                       WinMgr after:1:setLDLoc; eq? $(hcaInit) 1 ne? $(WMautoArrive) yes autoArrive; sendto up spooled

macro  setLDLoc	       LDloc_type $(UNIT_NONE); eq? $(locunit.$(last_beacon)) $(UNIT_SHOVEL) LDloc_type $(UNIT_SHOVEL);\
                       eq? $(locunit.$(last_beacon)) $(UNIT_DUMP) LDloc_type $(UNIT_DUMP);\
                       eq? $(locunit.$(last_beacon)) $(UNIT_CRUSHER) LDloc_type $(UNIT_CRUSHER);\
                       eq? $(locunit.$(last_beacon)) $(UNIT_STOCKPILE) LDloc_type $(UNIT_STOCKPILE);\
                       eq? $(locunit.$(last_beacon)) $(UNIT_BLAST) LDloc_type $(UNIT_BLAST);\
                       LDloc_valid 1

macro  autoArrive      eq? $(hcadebug) 1 HCADBG "autoArrive" "at $(FormatDate)";\
                       ne? $(sfnextact) $(SF_ARRIVE) HCA_case $(INVALID_CASE);\
                       eq? $(sfnextact) $(SF_ARRIVE) autoArrvOn yes;\
                       eq? $(LDloc_type) $(UNIT_DUMP) eq? $(commstat) yes HCA_case $(CONN_ARR_DUMP);\
                       eq? $(LDloc_type) $(UNIT_DUMP) eq? $(commstat) no HCA_case $(ARR_DUMP);\
                       eq? $(LDloc_type) $(UNIT_CRUSHER) eq? $(commstat) yes HCA_case $(CONN_ARR_DUMP);\
                       eq? $(LDloc_type) $(UNIT_CRUSHER) eq? $(commstat) no HCA_case $(ARR_DUMP);\
                       eq? $(LDloc_type) $(UNIT_BLAST) eq? $(commstat) yes HCA_case $(CONN_ARR_SHOV);\
                       eq? $(LDloc_type) $(UNIT_BLAST) eq? $(commstat) no HCA_case $(ARR_SHOV);\
                       eq? $(LDloc_type) $(UNIT_SHOVEL) eq? $(commstat) yes HCA_case $(CONN_ARR_SHOV);\
                       eq? $(LDloc_type) $(UNIT_SHOVEL) eq? $(commstat) no HCA_case $(ARR_SHOV);\
                       eq? $(LDloc_type) $(UNIT_STOCKPILE) eq? $(commstat) yes HCA_case $(CONN_ARR_SHOV);\
                       eq? $(LDloc_type) $(UNIT_STOCKPILE) eq? $(commstat) no HCA_case $(ARR_SHOV);\
                       eq? $(LDloc_valid) 0 HCA_case $(INVALID_CASE);\
                       eq? $(hcadebug) 1 HCADBG "LDloc_type-$(LDloc_type)" "HCA_case-$(hcaCaseDebug.$(HCA_case))";\
                       eq? $(HCA_case) $(CONN_ARR_DUMP) checkVelocity;\
                       eq? $(HCA_case) $(ARR_DUMP) checkVelocity;\
                       eq? $(HCA_case) $(CONN_ARR_SHOV) checkVelocity;\
                       eq? $(HCA_case) $(ARR_SHOV) checkVelocity;\   
                       WMautoArrive no;\                    
                       eq? $(autoArrvOn) yes contautoArrive;
macro  contautoArrive  WMautoArrive yes;WinMgr after:$(CASE_RETRY_TIME):autoArrive;					   

macro  autoBucket      eq? $(dipperEvtRcv) no eq? $(hcadebug) 1 HCADBG "autoBucket:" "sending hcaEqmtInfo at $(FormatDate)";\
                       eq? $(dipperEvtRcv) no eq? $(commstat) yes EQ-REQ "hcaEqmtInfo";\
                       eq? $(dipperEvtRcv) no eq? $(commstat) yes HCA_case $(CONN_BKT);\
                       eq? $(dipperEvtRcv) no eq? $(commstat) no HCA_case $(HCA_BKT);\
                       eq? $(HCA_case) $(CONN_BKT) checkTruckInQ;\
                       eq? $(HCA_case) $(HCA_BKT) ne? $(shovelPos) none checkDistance;\
					   ne? $(sfnextact) $(SF_LOAD) 'autoBktOn no';\
                       WMautoBucket no;\
                       eq? $(autoBktOn) yes contautoBucket;
macro  contautoBucket  WMautoBucket yes;WinMgr after:$(CASE_RETRY_TIME):autoBucket;				

macro HCA.kstate_extra eq? $(hcaInit) 1 updateHCAAct;

macro  updateHCAAct    eq? $(state) 17 hcaAfterLoad;\
                       eq? $(state) 9 hcaAfterFull;\
                       eq? $(state) 10 hcaAfterArrive;\
                       eq? $(state) 8 hcaAfterLoad;\
                       eq? $(state) 2 hcaAfterArrive;\
                       eq? $(state) 6 hcaAfterAssign;\
                       eq? $(state) 7 hcaAfterArrvSh;\
                       eq? $(state) 4 stopHcaAction;\
                       eq? $(state) 3 stopHcaAction;\
                       eq? $(state) 0 stopHcaAction;

macro  stopHcaAction   eq? $(sfnextact) $(SF_LOAD) autoBktOn no;\
                       eq? $(sfnextact) $(SF_FULL) autoFullOn no;\
                       eq? $(sfnextact) $(SF_ARRIVE) autoArrvOn no;\
                       eq? $(sfnextact) $(SF_ASSIGN) autoAssignOn no;

macro  doActArrive        eq? $(state) 6 hcaAfterArrvSh;\
                       eq? $(state) 9 hcaAfterArrive;\
					   eq? $(sfnextloc) dump LDloc_type $(UNIT_DUMP);\
					   eq? $(sfnextloc) shovel LDloc_type $(UNIT_SHOVEL);\
                       dest ''; eq? $(sfnextloc) dump arrivedatdump; eq? $(sfnextloc) shovel arrivedatshovel; ARRIVE; KBEEP 1;

macro  doActAssign        dest ''; eq? $(sfnextloc) dump assignedatshovel; eq? $(sfnextloc) shovel assignedatdump; ASSIGN; KBEEP 1;\
                       hcaAfterAssign;

macro  doActLoad          LOAD; eq? $(hcaInit) 1 hcaAfterLoad;

macro  SendTrkFull     FULL "None" "None"; hcaAfterFull

in     EQMTINFO 0x078d sddlls?sss procEqmtInfo

macro  procEqmtInfo    eq? $(hcadebug) 1 HCADBG "EQMTINFO" "$1,$(dest),$2,$3,$4,$5,$6"; eq? $1 $(dest) updateShovInfo;

macro  updateShovInfo  shovelStat $2; shovelBcn $3; shovelPos $4,$5; shovNxtQTrk $6;

macro  clrLocInfo      loc_id "Unknown"; eq? $(updateFromCentral) 0 loc_type "Unknown";loc_unit 0;loc_stat "Unknown";loc_auto 0

/*     Digital Input support */
#ifndef ENABLE_DIG_INP
#define ENABLE_DIG_INP no
#endif
macro  checkDinInp     ne? ENABLE_DIG_INP no ne? $(Vsms digitals) none 'isDigInpAvail yes;okToCheckDin yes;getDigInput 0'

macro  checkDumpSwitch ne? ENABLE_DIG_INP no eq? $(okToCheckDin) yes getDigInput 0

macro  checkDigInput0  HCA_case $(INVALID_CASE);\
                       eq? $(digInp0) $(DIGITAL_INPUT_ON) eq? $(lastDigInp0) $(DIGITAL_INPUT_OFF) dinSwitchActive yes;\
                       eq? $(hcadebug) 1 HCADBG "checkDigInputs:" "$(digInp0),$(lastDigInp0),$(dinSwitchActive) at $(FormatDate)";\
                       eq? $(commstat) yes eq? $(digInp0) $(DIGITAL_INPUT_ON) eq? $(digInp0) $(lastDigInp0) HCA_case $(CONN_ARR_DUMP_DIN);\
                       eq? $(commstat) no eq? $(digInp0) $(DIGITAL_INPUT_ON) eq? $(digInp0) $(lastDigInp0) HCA_case $(ARR_DUMP_DIN);\
                       eq? $(commstat) yes eq? $(digInp0) $(DIGITAL_INPUT_OFF) eq? $(dinSwitchActive) yes HCA_case $(CONN_ASSIGN_DIN);\
                       eq? $(commstat) no eq? $(digInp0) $(DIGITAL_INPUT_OFF) eq? $(dinSwitchActive) yes HCA_case $(ASSIGN_DIN);\
                       ne? $(HCA_case) $(INVALID_CASE) checkNxtAct;\
                       okToCheckDin yes;\
                       eq? $(autoArrvOn) yes eq? $(sfnextloc) dump contDigInput 0;\
                       ne? $(autoArrvOn) yes eq? $(autoAssignOn) yes contDigInput 0;

macro  checkDigInput1  okToCheckDin yes
macro  checkDigInput2  okToCheckDin yes

in     contDigInput    INT_RPC d	okToCheckDin no;WinMgr after:$(CASE_RETRY_TIME):'getDigInput $1'

in     getDigInput     INT_RPC d 	lastDigInp$1 $(digInp$1);digInp$1 $(Vsms dchan:$1);checkDigInput$1;

/* Deprecated digital input functions */
macro  OLDupdateDigInputs okToCheckDin no; getDigInputs; lastDigInp0 $(digInp0); okToCheckDin yes;\
                       WinMgr after:$(CASE_RETRY_TIME):getDigInputs;
macro  updateDigInputs lastDigInp0 $(digInp0); okToCheckDin yes; getDigInputs
macro  getDigInputs    foreach "$(Vsms digitals)"; do 'digInp\$1 \$2';\
                       eq? $(okToCheckDin) yes checkDigInputs;
macro  setLastDigInp   foreach "$(Vsms digitals)"; do 'lastDigInp\$1 $(digInp\$1)'
/* End Digital Input support */


#endif
