#!/psw/cpp
/*
 * * * * * * * * * * * * * * * * * * *
 *  DISPATCH Real-Time Firmware Module
 * Copyright (c) Modular Mining Systems, 1982-1995
 *               All Rights Reserved
 *  $RCSfile: Macro.cfg,v $
 * $Revision: 1.2 $
 *   $Author: dcitron $
 *     $Date: 2013/09/09 23:15:39 $
 *    $State: Exp $
 *   Purpose: GOIC object configuration file.
 * * * * * * * * * * * * * * * * * * *
 */
#if #arch(pe.net)
/* Port Embedded Hub and Goic share the same Macro space so we don't need to send velocity to goic */
macro sendvel gpsVel $(GpsTruck velocity);checkVelocity
#endif

/* Code to disable messaging over 5 mph: */

symbol  gcActive        1
symbol  gpsVel          0
                        /* 223 cm/s ~ 5 mph */
symbol  threshVel       223

in      GPSVEL          0x1974 d gpsVel $1;checkVelocity

macro   checkVelocity   eq? $( max $(gpsVel) $(threshVel) ) $(threshVel) ne? $(gcActive) 1 setActive;eq? $( min $(gpsVel) $(threshVel) ) $(threshVel) ne? $(gcActive) 0 setInactive

macro   setActive       gcActive 1

macro   setInactive     gcActive 0;Kp2 unpost

macro   kpMessage       eq? $(gcActive) 1 DoMessage;\
                        eq? $(gcActive) 0 MessageError

macro   MessageError    w0.Text write:$(sm.disable);KBEEP 2

macro   DoMessage       kplabel $(sm.mesg);kpaction 'sendmsg';Kp2 label:$(kplabel) post
