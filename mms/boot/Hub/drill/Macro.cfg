%!/psw/cpp
/*
 * * * * * * * * * * * * * * * * * * *
 *  DISPATCH Real-Time Firmware Module
 * Copyright (c) Modular Mining Systems, 1982-1996
 *               All Rights Reserved
 *  $RCSfile: Macro.cfg,v $
 * $Revision: 1.4 $
 *   $Author: latum $
 *     $Date: 2004/02/09 22:45:53 $
 *    $State: Exp $
 *   Purpose: Macro.cfg extensions for drill monitoring
 *	      system support.
 * * * * * * * * * * * * * * * * * * *
 */

/*
 * ---------- IMPORTANT! PLERASE READ CAREFULLY --------------
 * drill hubs are the most customized of all, because of the variety
 * of devices and configurations. The intention of this generic
 * Macro.cfg file is not to solve everything but to define some
 * standard macros that can be re-used in a variety of ways depending
 * on the required configuration. Not all of these will be used in
 * any single installation and most are there simply to override
 * standard manual operation. For example, the "ExtendJacks" macro
 * signifies that the operator has started lowering the jacks.
 * Normal operation is that the operator pushes a button on the CGC
 * before this occurs and the macro on the hub is never used.
 * However, some 3rd party systems or our own Vsms system
 * may be able to detect this action automatically and call the macro
 * on the hub, which has the same result as the operator pressing
 * the button.
 *
 * the generic cycle "events" for a drill are as follows
 *
 * start tramming       the jacks are off the ground and the operator starts moving the
 *                      drill to another drill hole position
 *
 * extend jacks         drill stops tramming to new position and the operator is lowering
 *                      the jacks to stabilize the drill to the final drilling position
 *
 * bit on ground        the operator has dropped the bit onto the ground and is about to
 *                      start drilling
 *
 * start hole           the operator actually initiates the drilling
 *
 * end hole             the drill stem has been retreived from the hole, the bit is secured
 *                      on the deck.
 */

/*
 * the following macros can be used on the HUB to cause an action on the CGC
 */
macro	HubStartTram	CP-SWITCH 100
macro	HubExtendJacks	CP-SWITCH 101
macro	HubBitLowered	CP-SWITCH 102
macro	HubStartHole	CP-SWITCH 103
macro	HubEndHole	CP-SWITCH 104
macro	HubStartAddRod	CP-SWITCH 105
macro	HubEndAddRod	CP-SWITCH 106
macro	HubAddRod	CP-SWITCH 107

/*
 * the following macros are generically available to be implemented on the HUB and
 * are triggered by an equivalent action on the CGC. This is mainly useful for the
 * legacy Vsms drill hub but possibly as an interface to 3rd party drill systems
 *
 * 'startAddRod' indicates that the operator is just commencing to retract the drill
 * head and add a new rod
 *
 * 'endAddRod' indicates that the operator has finished adding a rod and is ready to
 * start drilling again. The bit is assumed to be at the bottom of the hole and the
 * deckwrench is disengaged
 *
 * 'addRod' can be used to add a preset amount of length to the drill stem
 *
 * 'addRodLength' can be used to add a specified amount of length to the drill stem
 *
 * 'zeroDepth' can be used to tell the Vsms or other 3rd party system that the bit is
 * on the ground
 */
macro	GCStartAddRod
macro	GCEndAddRod
macro	GCAddRod
macro	GCAddRodLength
macro	GCZeroDepth

/*
 * by default the VRATE and VSHAFT rpcs don't do anything in the case
 * that we have no Vsms or a 3rd party system. Override in the 3rd
 * part specific Macro file or the VsmsDrill files
 */
out     KDRILL  0x5d    sss     sendto Goic

/*
 * generic signal from CGC to send out any profiles (if applicable)
 */
in      VRATES  0x92    d

/*
 * generic signal from CGC: has some standard actions associated with it:
 */
in      VSHAFT  0x94    d	eq? $1 0 GCZeroDepth;\
				eq? $1 1 GCStartAddRod;\
				eq? $1 2 GCEndAddRod;\
				eq? $1 3 GCAddRod;\
				eq? $(min $1 10) 10 GCAddRodLength

/*
 * standard way to send realtime data for display on gauges screen. All data is sent
 * as raw analog input values. Formatting and conversions are done inside the Gauge
 * objects
 */
out	KDATA	0x97	[d]	sendto Goic

/*
 * we include the generic Macro.cfg here and not earlier so-that the OPTIONS/Macro.cfg
 * files can override anything in this here Macro.cfg
 */
#include <Hub/Macro.cfg>

