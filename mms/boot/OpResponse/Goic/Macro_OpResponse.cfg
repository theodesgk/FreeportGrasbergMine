#!/psw/cpp
/*
 * * * * * * * * * * * * * * * * * * *
 *  DISPATCH Real-Time Firmware Module
 * Copyright (c) Modular Mining Systems, 1982-1996
 *               All Rights Reserved
 *  $RCSfile: Macro_OpResponse.cfg,v $
 * $Revision: 1.4 $
 *   $Author: dcitron $
 *     $Date: 2018/08/10 03:03:43 $
 *    $State: Exp $
 * * * * * * * * * * * * * * * * * * *
 */

symbol   abortTest      60
symbol  tbt_support TBT_NO

/* If operator fails to respond we send in EQ-REQ with abort seconds     */
/* we have to multiply abortSecs by 10.1 since we are using milliseconds */

symbol   actAbort      0
macro    kpActAbort    actAbort $(* $(abortTest) 10.1)
macro    kpNoFatgResp   'kpActAbort;EQ-REQ "opresp" [ "$(actAbort)" "999" ]'


macro   gotResp   WinMgr beep:0 cancel:beepOn: cancel:noResp:
macro   noResp    WinMgr beep:0;FatgTest unpost;kpNoFatgResp

symbol lbl0
symbol lbl1
symbol lbl2
symbol lbl3

/* Response Warning/Test Message Code - the response time to this message is recorded on the Hub */
in	OS-RESP    0x762    s?[s]     abortTest $1; foreach $2; do setlabel; setupFatgTest; postFatgTest$(tbt_support); fatgTestOptns
macro	setlabel lbl$1 $2

macro    setupFatgTest        FatgTest.l1 label:'$(lbl0)'; FatgTest.b1 label:'$(lbl1)'; FatgTest.b2 label:'$(lbl2)'; FatgTest.b3 label:'$(lbl3)'
macro    postFatgTest         TOHUB startCounting "nil"; FatgTest action:sendFatgRespHub post
macro    postFatgTestTBT_NO   TOHUB startCounting "nil"; FatgTest action:sendFatgRespHub post
macro    postFatgTestTBT_YES  eq? $(ObjSh dispActive) no ShowDispatch;TOHUB startCounting "nil"; FatgTest action:sendFatgRespHub post
macro	 sendFatgRespHub      TOHUB sendFatgRespSecs "nil"
macro    fatgTestOptns        WinMgr after:$(abortTest):noResp: after:$(abortTest):'TOHUB stopCounting "nil"':



