%!/psw/cpp

symbol	gpsparam
symbol	gpsrecei
symbol	gpsvalue
symbol	qrystat		0

/* Status code from Gps Mode */

symbol	mode.1 1  	/* Autonomous */
symbol	mode.3 3  	/* Float */
symbol	mode.4 4  	/* Fixed */
symbol	mode.5 5  	/* Float */

symbol	maxp.0 10	/* Number of sats 'green' boundary */
symbol	maxp.1 3	/* Diff Age  'green' boundary */
symbol	maxp.2 8	/* GST Horiz 'green' boundary */
symbol	maxp.3 10	/* GST Vert. 'green' boundary */
symbol	maxp.4 1	/*   DOP     'green' boundary */


symbol  minp.0 4	/* Number of sats 'red' boundary */
symbol  minp.1 5	/* Diff Age  'red' boundary */
symbol  minp.2 20	/* GST Horiz 'red' boundary */
symbol  minp.3 20	/* GST Vert. 'red' boundary */
symbol  minp.4 2	/*   DOP     'red' boundary */

macro	GpsStatusPost	WinMgr window:wGpsstat ;\
                        RefreshScreen

/* Cycle for update the data Gps Status */
macro	QueryStat	QueryGpsStat; WinMgr after:6:QueryStat

macro 	QueryGpsStat	eq? $(qrystat) 1	GPS-SREQ 1

/* Update of the GpsStatus */
macro	UpdateGpsStat   eq? "$1" "1"    UpdateGps1Stat;\
			eq? "$1" "2"	UpdateGps2Stat;\
			UpdateGpsText

macro	UpdateGps1Stat	gpsrecei 1;\
			wGpsstat.gps10 label:$2; gpsparam 0; gpsvalue $2; UpdatepColor;\
			wGpsstat.gps11 label:$3; gpsparam 1; gpsvalue $3; UpdatepColor;\
			wGpsstat.gps12 label:$4; gpsparam 2; gpsvalue $4; UpdatepColor;\
			wGpsstat.gps13 label:$5; gpsparam 3; gpsvalue $5; UpdatepColor;\
			wGpsstat.gps14 label:$7; gpsparam 4; gpsvalue $7; UpdatepColor;\
			wGpsstat.gps15 label:$6; gpsparam 5; gpsvalue $6; UpdatepColorMode1

macro	UpdateGps2Stat	gpsrecei 2;\
			wGpsstat.gps20 label:$2; gpsparam 0; gpsvalue $2; UpdatepColor;\
			wGpsstat.gps21 label:$3; gpsparam 1; gpsvalue $3; UpdatepColor;\
			wGpsstat.gps22 label:$4; gpsparam 2; gpsvalue $4; UpdatepColor;\
			wGpsstat.gps23 label:$5; gpsparam 3; gpsvalue $5; UpdatepColor;\
			wGpsstat.gps24 label:$7; gpsparam 4; gpsvalue $7; UpdatepColor;\
			wGpsstat.gps25 label:$6; gpsparam 5; gpsvalue $6; UpdatepColorMode2

macro 	UpdatepColor	eq? $(max $(maxp.$(gpsparam)) $(minp.$(gpsparam))) $(maxp.$(gpsparam)) UpdatepColor1;\
			eq? $(max $(maxp.$(gpsparam)) $(minp.$(gpsparam))) $(minp.$(gpsparam)) UpdatepColor2

macro	UpdatepColor1	eq? $(min $(gpsvalue) $(minp.$(gpsparam))) $(gpsvalue) wGpsstat.gps$(gpsrecei)$(gpsparam) colors:Down;\
			eq? $(max $(gpsvalue) $(minp.$(gpsparam))) $(gpsvalue) \
			eq? $(min $(gpsvalue) $(maxp.$(gpsparam))) $(gpsvalue) wGpsstat.gps$(gpsrecei)$(gpsparam) colors:Delay;\
			eq? $(max $(gpsvalue) $(maxp.$(gpsparam))) $(gpsvalue) wGpsstat.gps$(gpsrecei)$(gpsparam) colors:Ready

macro	UpdatepColor2	eq? $(min $(gpsvalue) $(maxp.$(gpsparam))) $(gpsvalue) wGpsstat.gps$(gpsrecei)$(gpsparam) colors:Ready;\
			eq? $(max $(gpsvalue) $(maxp.$(gpsparam))) $(gpsvalue) \
			eq? $(min $(gpsvalue) $(minp.$(gpsparam))) $(gpsvalue) wGpsstat.gps$(gpsrecei)$(gpsparam) colors:Delay;\
			eq? $(max $(gpsvalue) $(minp.$(gpsparam))) $(gpsvalue) wGpsstat.gps$(gpsrecei)$(gpsparam) colors:Down

macro   UpdateGpsText	eq? "$(ComMgr eqmtGpsStatus)" "Pos"  wGpsstat.v1 label:"$(gpsStatVal.1)";\
			eq? "$(ComMgr eqmtGpsStatus)" "Elev" wGpsstat.v1 label:"$(gpsStatVal.2)";\
			eq? "$(ComMgr eqmtGpsStatus)" "Ok"   wGpsstat.v1 label:"$(gpsStatVal.3)"

macro	UpdatepColorMode1 wGpsstat.gps1$(gpsparam) colors:Down label:"$(gpsStatMod.5)";\
                          eq? $(gpsvalue) $(mode.1) wGpsstat.gps1$(gpsparam) colors:Down label:"$(gpsStatMod.1)";\
                          eq? $(gpsvalue) $(mode.3) wGpsstat.gps1$(gpsparam) colors:Delay  label:"$(gpsStatMod.3)";\
                          eq? $(gpsvalue) $(mode.4) wGpsstat.gps1$(gpsparam) colors:Ready label:"$(gpsStatMod.4)";\
                          eq? $(gpsvalue) $(mode.5) wGpsstat.gps1$(gpsparam) colors:Down  label:"$(gpsStatMod.3)";\
                          eq? "$(ComMgr eqmtGpsStatus)" "Pos"  wGpsstat.gps16 colors:Down  label:"Pos";\
                          eq? "$(ComMgr eqmtGpsStatus)" "Elev" wGpsstat.gps16 colors:Delay label:"Elév";\
                          eq? "$(ComMgr eqmtGpsStatus)" "Ok"   wGpsstat.gps16 colors:Ready label:"$(ComMgr filteredCenterElev)"

macro	UpdatepColorMode2 wGpsstat.gps2$(gpsparam) colors:Down label:"$(gpsStatMod.5)";\
			  eq? $(gpsvalue) $(mode.1) wGpsstat.gps2$(gpsparam) colors:Down label:"$(gpsStatMod.1)";\
                          eq? $(gpsvalue) $(mode.3) wGpsstat.gps2$(gpsparam) colors:Delay label:"$(gpsStatMod.3)";\
                          eq? $(gpsvalue) $(mode.4) wGpsstat.gps2$(gpsparam) colors:Ready label:"$(gpsStatMod.4)";\
                          eq? $(gpsvalue) $(mode.5) wGpsstat.gps2$(gpsparam) colors:Down  label:"$(gpsStatMod.3)";\
                          eq? "$(ComMgr eqmtGpsStatus)" "Pos"  wGpsstat.gps26 colors:Down  label:"Pos";\
                          eq? "$(ComMgr eqmtGpsStatus)" "Elev" wGpsstat.gps26 colors:Delay label:"Elév";\
                          eq? "$(ComMgr eqmtGpsStatus)" "Ok"   wGpsstat.gps26 colors:Ready label:"$(ComMgr filteredCenterElev)"
