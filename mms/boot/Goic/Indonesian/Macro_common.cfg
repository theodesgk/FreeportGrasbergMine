%!/psw/cpp
/*
 * * * * * * * * * * * * * * * * * * *
 *  DISPATCH Real-Time Firmware Module
 * Copyright (c) Modular Mining Systems, 1982-1998
 *               All Rights Reserved
 *  $RCSfile: Macro_common.cfg,v $
 * $Revision: 1.2 $
 *   $Author: zambetis $
 *     $Date: 2011/06/06 17:29:30 $
 *    $State: Exp $
 *   Purpose: GOIC configuration common to all clients, equipment,
 *	      and languages.
 * * * * * * * * * * * * * * * * * * *
 */
#include <Version.h>
#include <Goic/common/Macro_English.cfg>
#if #arch(cgc) || #arch(pe)
	stack 8192
#endif
#if #class(drill)
in	KDISP	0x40	s	w0.Text write:"$1\n";\
				wDrilling.v1 write:"$1\n";\
				hp.Text write:"$1\n";\
				hp.Text map:y;\
				WinMgr after:5:'hp.Text map:n'

#elif  #class(loader) || #class(shovel) || #class(dozer)
in	KDISP	0x40	s	w0.Text write:"$1\n";\
				hp.Text write:"$1\n";\
				hp.Text map:y;\
				WinMgr after:5:'hp.Text map:n'

#else
in	KDISP	0x40	s	w0.Text write:"$1\n"
#endif

symbol	state 0
symbol	prevstate 0
macro	NewState

#if #class(loader) || #class(shovel)

in	KSTATE	0x41	b?ssssss	prevstate $(state);\
					state $1;loc $2;next $3;w0.Icon icon:$(icon.$1);\
                                        w0.v1 label:$2;w0.v2 label:$3;w0.v3 label:$4;\
                                        w0.Text write:$5\n;w0.v4 label:$6;WinMgr audio:$7;\
					ne? $(prevstate) $(state) NewState

in	KSTATE2	0x32	b?ssssss	prevstate $(state);\
					state $1;loc $2;next $3;w0.Icon icon:$(icon.$1);\
					w0.v1 label:$2;w0.v2 label:$3;w0.v3 label:$4;\
					w0.Text write:$5;w0.Text write:\n;w0.v4 label:$6;WinMgr audio:$7;\
					ne? $(prevstate) $(state) NewState

#else

in	KSTATE	0x41	b?ssssss	prevstate $(state);\
					state $1;loc $2;next $3;w0.Icon icon:$(icon.$1);\
					w0.v1 label:$2;w0.v2 label:$3;w0.v3 label:$4;\
					w0.Text write:$5\n;WinMgr audio:$7;\
					ne? $(prevstate) $(state) NewState

in	KSTATE2	0x32	b?ssssss	prevstate $(state);\
					state $1;loc $2;next $3;w0.Icon icon:$(icon.$1);\
					w0.v1 label:$2;w0.v2 label:$3;w0.v3 label:$4;\
					w0.Text write:$5;w0.Text write:\n;WinMgr audio:$7;\
					ne? $(prevstate) $(state) NewState

#endif

in	KASK	0x43	ssss	$2 label:$1 action:$4 post

#if #class(shovel) || #class(loader)
in	KMATL	0x44	sb	matl.$2 $1;setMatl
#endif

in	KACK	0x46	b	Ok label:$(pressOk) action:'' post;WinMgr after:$1:beepOn: after:30:noOk:
in	KSIM	0x48	b	state $1;w0.Icon icon:$(icon.$1)
in	KMENU	0x49	s[s]	$1 items:$2
in	KBCST	0x4a	bss	eq? $2 CLASS getBcst;eq? "$2" "all" getBcst
in	KTABLE	0x4b	ss[s]	$1.title label:"$2";foreach $3;do $1.t\$1 label:"\$2"
macro	getBcst	w0.Text write:$3\n;KBEEP $1
in	KRESET	0x4d	v	ObjSh reset
in	KINIT	0x4e	v	echo KINIT not implemented...
in	KBLINK	0x4f	sb?s	$1 blink:$(* $2 5):blink:default
in	KD1	0x50	s	w0.v1 label:$1
in	KD2	0x51	s	w0.v2 label:$1
in	KD3	0x52	s	w0.v3 label:$1
in	KCONTRAST 0x53	b	w0.Sl2 value:$1

#if #class(drill)
in	KVAR	0x55	ss?dbb	saveFont $(w0.$1 font);\
				saveText "$(w0.$1 label)";\
				eq? $5 1 w0.$1 font:Tiny;\
				w0.$1 label:$2;\
				eq? $1 v1 wDrilling.v1 write:$2;\
				eq? $1 v1 wDrilling.v1 write:"\n";\
				ne? $3 0 KBEEP $3;\
				ne? $4 0 WinMgr after:$4:'w0.$1 label:"$(saveText)" font:$(saveFont)'
#else
in	KVAR	0x55	ss?db	saveFont $(w0.$1 font);\
				saveText "$(w0.$1 label)";\
				w0.$1 font:Tiny label:$2;\
				ne? $3 0 WinMgr beep:$3;\
				ne? $4 0 WinMgr after:$4:'w0.$1 label:$(saveText);w0.$1 font:$(saveFont)'
#endif

in	KPRSM	0x42	ss	w1.$1 label:$2
in	KLIGHT	0x56	b	w0.Sl1 value:$1
in	KSCROLL	0x58	s	w0.Text write:$1\n
in	KBEEP	0x5a	b	ne? $1 0 WinMgr beep:-1 after:$1:beepOff:
in	KDACK	0x5b	s	w0.Text write:$1\n;KACK 5
in	KSHOVEL	0x5c	bdsss	matl $1;setMatl;w0.v1 label:$3;w0.v2 label:$4;w0.v3 label:$5
#if #class(truck)
in	KTBCST	0x5e	bs	w0.Text write:$2\n;KBEEP $1
in	KSBCST	0x5f	bs
#include <WeighSystem.h>
#endif
#if #class(shovel) || #class(lhd) || #class(loader)
in	KTBCST	0x5e	bs
in	KSBCST	0x5f	bs	w0.Text write:$2\n;KBEEP $1
#include <WeighSystem.h>
#endif
#if #class(lhd) || #class(train)
#include <RfTag.h>
#endif
in	CP-SWITCH 0x18a b	eq? $1 1 WinMgr press:w0.Icon
out	CP-PING	0x18b	s,d	sendto up
out	CP-CELL	0x193	v,d	sendto up
in	KBD-REMOTE 0x19f d	kbd.$1
out	LOCAL-ID 0x301	d,d	sendto up
out	REPT-REQ 0x290	ss	sendto up
macro	kbd.1	WinMgr event:pick
macro	kbd.2	WinMgr event:right
macro	kbd.4	WinMgr event:left
macro	kbd.8	WinMgr event:up
macro	kbd.16	WinMgr event:down
symbol	Kpinit	''
symbol	loc	none
symbol	icon.0	logo
symbol	icon.1	down
symbol	icon.2	ready
symbol	icon.3	standby
symbol	icon.4	delay
symbol	icon.5	tiedown
#if #class(truck)
symbol	icon.6	empty
symbol	icon.7	waiting
symbol	icon.8	loading
symbol	icon.9	hauling
symbol	icon.10	dumping
macro	rpc.0	kpLogOn
macro	rpc.1	kpReady
macro	rpc.2	kpAssign
macro	rpc.3	kpReady
macro	rpc.4	kpReady
macro	rpc.5	kpLogOn
macro	rpc.6	kpArrive
macro	rpc.7	kpLoad
macro	rpc.8	kpFull
macro	rpc.9	kpArrive
macro	rpc.10	kpAssign
#endif
#if #class(shovel) || #class(loader)
symbol	icon.6	left
symbol	icon.7	right
macro	rpc.0	kpLogOn
macro	rpc.1	kpReady
macro	rpc.2	kpIdle
macro	rpc.3	kpReady
macro	rpc.4	kpReady
macro	rpc.5	kpLogOn
macro	rpc.6	kpPanFull
macro	rpc.7	kpPanFull
macro	rpc.8	kpPanFull
symbol	matl	0
symbol	mst.0	6
symbol	mst.1	7
symbol	mst.2	8
macro	setMatl	state $(mst.$(matl));w0.Matl label:$(matl.$(matl));hp.matl label:$(matl.$(matl));eq? $(actwin) wSplits wSplits.ab$(matl) label:"$(cfgLbl.$(+ $(matl) 6)):\n$(matl.$(matl))"
#else
macro	setMatl	state $(mst.$(matl));w0.Matl label:$(matl.$(matl))
#endif
macro	kpFull	FULL "$(matl)" "$(matl.$(matl))"

macro	none	''
macro	beepOn	WinMgr beep:-1
macro	beepOff	WinMgr beep:0
macro	gotOk	WinMgr beep:0 cancel:beepOn: cancel:noOk:
macro	noOk	WinMgr beep:0;Ok unpost;Macro NOOK:0
macro	noTalk	Ok action:'' label:"Tidak dapat mengirim $2 ke $1" post

macro	PowerUp	Macro PWRUP:Goic, vVERSION

/*Reset the label in the shovel's screen*/
macro UpdateInfoLabel 	w0.v4 label:"0";\
			w0.info0 label:"0";\
			w0.info1 label:"0";\
			w0.info2 label:"0"
macro UpdateRecall RECALL
/*
 * Executed at power up - called by the WinMgr object
 * at time 0
 */
macro	Init	Macro KSTATE:0;\
		w0.ht relief:raised;\
		CheckStatusIndicators;\
   		actwin w0;\
		UpdateLabels;\
		WinMgr focus:w0.Icon

/*
 * Symbols to keep track of the active
 * (current) and last windows accessed
 */
symbol	actwin	w0
symbol	lastwin	

/*
 * General-purpose information
 * storage variable
 */
symbol	holder

/* if sendsplit is 1 then when operator
 * selects a material for a split it will
 * send it up to Dispatch
 */

symbol  sendsplit n

#ifdef OPT1
#	define OBJECT Macro
#	include <Cfg/Options.cfg>
#endif
