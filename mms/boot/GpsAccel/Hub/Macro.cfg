%!/psw/cpp
/*
 * * * * * * * * * * * * * * * * * * *
 *  DISPATCH Real-Time Firmware Module
 * Copyright (c) Modular Mining Systems, 1982-1998
 *               All Rights Reserved
 *  $RCSfile: Macro.cfg,v $
 * $Revision: 1.3 $
 *   $Author: dcitron $
 *     $Date: 2013/03/25 20:14:21 $
 *    $State: Exp $
 *   Purpose: Macro configuration file 
 * * * * * * * * * * * * * * * * * * *
 */
/*
 * This code is called by Vsms.cfg every second to
 * check wheather the truck is exceeding the
 * Lateral Acceleration values defined for the equipment
 * defined in EqLatAccelValues.cfg
 */

stack	8192
symbol	IsSentLAL 1
symbol	IsEmpty	1
/* decalare lateral acceleration limits and initialize
 * to large values so events won't be generated
 * These values will get adjusted by DISPATCH
 */
symbol	LAEmptyMax	10000
symbol	LAEmptyWarn	10000
symbol	LAFullMax	10000
symbol	LAFullWarn	10000
macro	CheckNotRepeatLAL	eq? $(IsSentLAL) 0
macro	CheckIsEmpty		eq? $(IsEmpty) 1
macro	CheckIsFull		eq? $(IsEmpty) 0
macro	CheckELAMax	ne? $(max $(LAEmptyMax) $(GpsTruck lacc)) $(LAEmptyMax)	eq? $(IsSentLAL) 0 sendLAEmptyMax
macro	CheckELAWarn	ne? $(max $(LAEmptyWarn) $(GpsTruck lacc)) $(LAEmptyWarn) eq? $(IsSentLAL) 0 sendLAEmptyWarn
macro	CheckNotELA	eq? $(max $(LAEmptyWarn) $(GpsTruck lacc)) $(LAEmptyWarn) IsSentLAL 0
macro	CheckFLAMax	ne? $(max $(LAFullMax) $(GpsTruck lacc)) $(LAFullMax) eq? $(IsSentLAL) 0 sendLAFullMax
macro	CheckFLAWarn	ne? $(max $(LAFullWarn) $(GpsTruck lacc)) $(LAFullWarn) eq? $(IsSentLAL) 0 sendLAFullWarn
macro	CheckNotFLA	eq? $(max $(LAFullWarn) $(GpsTruck lacc)) $(LAFullWarn) IsSentLAL 0
macro	sendLAEmptyWarn	IsSentLAL 1;VS-EVENT 671154182 $(LAEmptyWarn) $(GpsTruck x) $(GpsTruck y) $(GpsTruck lacc)
macro	sendLAEmptyMax	IsSentLAL 1;VS-EVENT 671154183 $(LAEmptyMax) $(GpsTruck x) $(GpsTruck y) $(GpsTruck lacc)
macro	sendLAFullWarn	IsSentLAL 1;VS-EVENT 671154184 $(LAFullWarn) $(GpsTruck x) $(GpsTruck y) $(GpsTruck lacc)
macro	sendLAFullMax	IsSentLAL 1;VS-EVENT 671154185 $(LAFullMax) $(GpsTruck x) $(GpsTruck y) $(GpsTruck lacc)
macro	CheckEmptyLA	CheckELAMax;CheckELAWarn;CheckNotELA
macro	CheckFullLA	CheckFLAMax;CheckFLAWarn;CheckNotFLA
macro	CheckLatAccel	eq? $(IsEmpty) 1 CheckEmptyLA;eq? $(IsEmpty) 0 CheckFullLA
macro	SetLAValues	LAEmptyMax $1;LAEmptyWarn $2;LAFullMax $3;LAFullWarn $4;eq? $5 1 IsEmpty 1;eq? $5 0 IsEmpty 0
/*
 * Respond to the query on whether the equipment
 * is exceeding the speed limit for that beacon
 */
out	VS-EVENT	0x0772	l?fddd	sendto up
in	LATACCELIN	0x0ccc	dddd?d	SetLAValues
